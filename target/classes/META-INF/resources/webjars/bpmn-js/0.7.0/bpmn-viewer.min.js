!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.BpmnJS=e()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module){var BpmnViewer=_dereq_("bpmn-js/lib/Viewer"),additionalModules=[_dereq_("diagram-js/lib/navigation/movecanvas"),_dereq_("diagram-js/lib/navigation/zoomscroll")];BpmnViewer.prototype._modules=BpmnViewer.prototype._modules.concat(additionalModules),module.exports=BpmnViewer},{"bpmn-js/lib/Viewer":2,"diagram-js/lib/navigation/movecanvas":73,"diagram-js/lib/navigation/zoomscroll":75}],2:[function(_dereq_,module){"use strict";function initListeners(diagram,listeners){var events=diagram.get("eventBus");listeners.forEach(function(l){events.on(l.event,l.handler)})}function checkValidationError(err){var pattern=/unparsable content <([^>]+)> detected([\s\S]*)$/,match=pattern.exec(err.message);return match&&(err.message="unparsable content <"+match[1]+"> detected; this may indicate an invalid BPMN 2.0 diagram file"+match[2]),err}function Viewer(options){this.options=options=_.extend({},DEFAULT_OPTIONS,options||{});var parent=options.container||$("body"),container=$('<div class="bjs-container"></div>').appendTo(parent);container.css({width:options.width,height:options.height,position:options.position}),this.container=container.get(0);{var logoData="iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAMAAADypuvZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADBQTFRFiMte9PrwldFwfcZPqtqN0+zEyOe1XLgjvuKncsJAZ70y6fXh3vDT////UrQV////G2zN+AAAABB0Uk5T////////////////////AOAjXRkAAAHDSURBVHjavJZJkoUgDEBJmAX8979tM8u3E6x20VlYJfFFMoL4vBDxATxZcakIOJTWSmxvKWVIkJ8jHvlRv1F2LFrVISCZI+tCtQx+XfewgVTfyY3plPiQEAzI3zWy+kR6NBhFBYeBuscJLOUuA2WVLpCjVIaFzrNQZArxAZKUQm6gsj37L9Cb7dnIBUKxENaaMJQqMpDXvSL+ktxdGRm2IsKgJGGPg7atwUG5CcFUEuSv+CwQqizTrvDTNXdMU2bMiDWZd8d7QIySWVRsb2vBBioxOFt4OinPBapL+neAb5KL5IJ8szOza2/DYoipUCx+CjO0Bpsv0V6mktNZ+k8rlABlWG0FrOpKYVo8DT3dBeLEjUBAj7moDogVii7nSS9QzZnFcOVBp1g2PyBQ3Vr5aIapN91VJy33HTJLC1iX2FY6F8gRdaAeIEfVONgtFCzZTmoLEdOjBDfsIOA6128gw3eu1shAajdZNAORxuQDJN5A5PbEG6gNIu24QJD5iNyRMZIr6bsHbCtCU/OaOaSvgkUyDMdDa1BXGf5HJ1To+/Ym6mCKT02Y+/Sa126ZKyd3jxhzpc1r8zVL6YM1Qy/kR4ABAFJ6iQUnivhAAAAAAElFTkSuQmCC",a=$('<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" />').css({position:"absolute",bottom:15,right:15,zIndex:100});$("<img/>").attr("src","data:image/png;base64,"+logoData).appendTo(a)}a.appendTo(container)}var Diagram=_dereq_("diagram-js"),BpmnModdle=_dereq_("bpmn-moddle"),$=window.$,_=window._,Importer=_dereq_("./import/Importer"),DEFAULT_OPTIONS={width:"100%",height:"100%",position:"relative"};Viewer.prototype.importXML=function(xml,done){var self=this;this.moddle=this.createModdle(),this.moddle.fromXML(xml,"bpmn:Definitions",function(err,definitions){return err?(err=checkValidationError(err),done(err)):void self.importDefinitions(definitions,done)})},Viewer.prototype.saveXML=function(options,done){done||(done=options,options={});var definitions=this.definitions;return definitions?void this.moddle.toXML(definitions,options,done):done(new Error("no definitions loaded"))},Viewer.prototype.createModdle=function(){return new BpmnModdle},Viewer.prototype.saveSVG=function(options,done){done||(done=options,options={});var canvas=this.get("canvas"),contentNode=canvas.getDefaultLayer(),defsNode=canvas._svg.select("defs"),contents=contentNode.innerSVG(),defs=defsNode&&defsNode.outerSVG()||"",bbox=contentNode.getBBox(),svg='<?xml version="1.0" encoding="utf-8"?>\n<!-- created with bpmn-js / http://bpmn.io -->\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+bbox.width+'" height="'+bbox.height+'" viewBox="'+bbox.x+" "+bbox.y+" "+bbox.width+" "+bbox.height+'" version="1.1">'+defs+contents+"</svg>";done(null,svg)},Viewer.prototype.get=function(name){if(!this.diagram)throw new Error("no diagram loaded");return this.diagram.get(name)},Viewer.prototype.invoke=function(fn){if(!this.diagram)throw new Error("no diagram loaded");return this.diagram.invoke(fn)},Viewer.prototype.importDefinitions=function(definitions,done){try{this.diagram&&this.clear(),this.definitions=definitions,this.diagram=this._createDiagram(this.options),this._init(this.diagram),Importer.importBpmnDiagram(this.diagram,definitions,done)}catch(e){done(e)}},Viewer.prototype._init=function(diagram){initListeners(diagram,this.__listeners||[])},Viewer.prototype._createDiagram=function(options){var modules=[].concat(options.modules||this.getModules(),options.additionalModules||[]);return modules.unshift({bpmnjs:["value",this],moddle:["value",this.moddle]}),options=_.omit(options,"additionalModules"),options=_.extend(options,{canvas:{container:this.container},modules:modules}),new Diagram(options)},Viewer.prototype.getModules=function(){return this._modules},Viewer.prototype.clear=function(){var diagram=this.diagram;diagram&&diagram.destroy()},Viewer.prototype.destroy=function(){this.clear(),$(this.container).remove()},Viewer.prototype.on=function(event,handler){var diagram=this.diagram,listeners=this.__listeners=this.__listeners||[];listeners=this.__listeners||[],listeners.push({event:event,handler:handler}),diagram&&diagram.get("eventBus").on(event,handler)},Viewer.prototype._modules=[_dereq_("./core"),_dereq_("diagram-js/lib/features/selection"),_dereq_("diagram-js/lib/features/overlays")],module.exports=Viewer},{"./core":3,"./import/Importer":9,"bpmn-moddle":14,"diagram-js":35,"diagram-js/lib/features/overlays":53,"diagram-js/lib/features/selection":57}],3:[function(_dereq_,module){module.exports={__depends__:[_dereq_("../draw"),_dereq_("../import")]}},{"../draw":6,"../import":11}],4:[function(_dereq_,module){"use strict";function BpmnRenderer(events,styles,pathMap){function addMarker(id,element){markers[id]=element}function marker(id){return markers[id]}function initMarkers(svg){function createMarker(id,options){var attrs=_.extend({fill:"black",strokeWidth:1,strokeLinecap:"round",strokeDasharray:"none"},options.attrs),ref=options.ref||{x:0,y:0},scale=options.scale||1;"none"===attrs.strokeDasharray&&(attrs.strokeDasharray=[1e4,1]);var marker=options.element.attr(attrs).marker(0,0,20,20,ref.x,ref.y).attr({markerWidth:20*scale,markerHeight:20*scale});return addMarker(id,marker)}createMarker("sequenceflow-end",{element:svg.path("M 1 5 L 11 10 L 1 15 Z"),ref:{x:11,y:10},scale:.5}),createMarker("messageflow-start",{element:svg.circle(6,6,5),attrs:{fill:"white",stroke:"black"},ref:{x:6,y:6}}),createMarker("messageflow-end",{element:svg.path("M 1 5 L 11 10 L 1 15 Z"),attrs:{fill:"white",stroke:"black"},ref:{x:11,y:10}}),createMarker("data-association-end",{element:svg.path("M 1 5 L 11 10 L 1 15"),attrs:{fill:"white",stroke:"black"},ref:{x:11,y:10},scale:.5}),createMarker("conditional-flow-marker",{element:svg.path("M 0 10 L 8 6 L 16 10 L 8 14 Z"),attrs:{fill:"white",stroke:"black"},ref:{x:-1,y:10},scale:.5}),createMarker("conditional-default-flow-marker",{element:svg.path("M 1 4 L 5 16"),attrs:{stroke:"black"},ref:{x:-5,y:10},scale:.5})}function computeStyle(custom,traits,defaultStyles){return _.isArray(traits)||(defaultStyles=traits,traits=[]),styles.style(traits||[],_.extend(defaultStyles,custom||{}))}function drawCircle(p,width,height,offset,attrs){_.isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var cx=width/2,cy=height/2;return p.circle(cx,cy,Math.round((width+height)/4-offset)).attr(attrs)}function drawRect(p,width,height,r,offset,attrs){return _.isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"}),p.rect(offset,offset,width-2*offset,height-2*offset,r).attr(attrs)}function drawDiamond(p,width,height,attrs){var x_2=width/2,y_2=height/2,points=[x_2,0,width,y_2,x_2,height,0,y_2];return attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"}),p.polygon(points).attr(attrs)}function drawLine(p,waypoints,attrs){return attrs=computeStyle(attrs,["no-fill"],{stroke:"black",strokeWidth:2,fill:"none"}),createLine(waypoints,attrs).appendTo(p)}function drawPath(p,d,attrs){return attrs=computeStyle(attrs,["no-fill"],{strokeWidth:2,stroke:"black"}),p.path(d).attr(attrs)}function as(type){return function(p,element){return handlers[type](p,element)}}function renderer(type){return handlers[type]}function renderEventContent(element,p){var event=getSemantic(element),isThrowing=isThrowEvent(event);return isTypedEvent(event,"bpmn:MessageEventDefinition")?renderer("bpmn:MessageEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:TimerEventDefinition")?renderer("bpmn:TimerEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:ConditionalEventDefinition")?renderer("bpmn:ConditionalEventDefinition")(p,element):isTypedEvent(event,"bpmn:SignalEventDefinition")?renderer("bpmn:SignalEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")&&isTypedEvent(event,"bpmn:TerminateEventDefinition",{parallelMultiple:!1})?renderer("bpmn:MultipleEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")&&isTypedEvent(event,"bpmn:TerminateEventDefinition",{parallelMultiple:!0})?renderer("bpmn:ParallelMultipleEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:EscalationEventDefinition")?renderer("bpmn:EscalationEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:LinkEventDefinition")?renderer("bpmn:LinkEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:ErrorEventDefinition")?renderer("bpmn:ErrorEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")?renderer("bpmn:CancelEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CompensateEventDefinition")?renderer("bpmn:CompensateEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:TerminateEventDefinition")?renderer("bpmn:TerminateEventDefinition")(p,element,isThrowing):null}function renderLabel(p,label,options){return textUtil.createText(p,label||"",options).addClass("djs-label")}function renderEmbeddedLabel(p,element,align){var semantic=getSemantic(element);return renderLabel(p,semantic.name,{box:element,align:align,padding:5})}function renderExternalLabel(p,element,align){var semantic=getSemantic(element);return semantic.name||(element.hidden=!0),renderLabel(p,semantic.name,{box:element,align:align,style:{fontSize:"11px"}})}function renderLaneLabel(p,text,element){var textBox=renderLabel(p,text,{box:{height:30,width:element.height},align:"center-middle"}),top=-1*element.height;textBox.transform("rotate(270) translate("+top+",0)")}function createPathFromConnection(connection){for(var waypoints=connection.waypoints,pathData="m  "+waypoints[0].x+","+waypoints[0].y,i=1;i<waypoints.length;i++)pathData+="L"+waypoints[i].x+","+waypoints[i].y+" ";return pathData}function attachTaskMarkers(p,element,taskMarkers){var position,obj=getSemantic(element),subprocess=_.contains(taskMarkers,"SubProcessMarker");return position=subprocess?{seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10},_.forEach(taskMarkers,function(marker){renderer(marker)(p,element,position)}),"bpmn:AdHocSubProcess"===obj.$type&&renderer("AdhocMarker")(p,element,position),obj.loopCharacteristics&&void 0===obj.loopCharacteristics.isSequential?void renderer("LoopMarker")(p,element,position):(obj.loopCharacteristics&&void 0!==obj.loopCharacteristics.isSequential&&!obj.loopCharacteristics.isSequential&&renderer("ParallelMarker")(p,element,position),obj.loopCharacteristics&&obj.loopCharacteristics.isSequential&&renderer("SequentialMarker")(p,element,position),void(obj.isForCompensation&&renderer("CompensationMarker")(p,element,position)))}function drawShape(parent,element){var type=element.type,h=handlers[type];return h?h(parent,element):DefaultRenderer.prototype.drawShape.apply(this,[parent,element])}function drawConnection(parent,element){var type=element.type,h=handlers[type];return h?h(parent,element):DefaultRenderer.prototype.drawConnection.apply(this,[parent,element])}function renderDataItemCollection(p,element){{var yPosition=(element.height-16)/element.height,pathData=pathMap.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.451,my:yPosition}});drawPath(p,pathData,{strokeWidth:2})}}function isCollection(element){return element.isCollection||element.elementObjectRef&&element.elementObjectRef.isCollection}function getDi(element){return element.businessObject.di}function getSemantic(element){return element.businessObject}function isTypedEvent(event,eventDefinitionType,filter){function matches(definition,filter){return _.all(filter,function(val,key){return definition[key]==val})}return _.any(event.eventDefinitions,function(definition){return definition.$type===eventDefinitionType&&matches(event,filter)})}function isThrowEvent(event){return"bpmn:IntermediateThrowEvent"===event.$type||"bpmn:EndEvent"===event.$type}DefaultRenderer.call(this,styles);var TASK_BORDER_RADIUS=10,INNER_OUTER_DIST=3,LABEL_STYLE={fontFamily:"Arial, sans-serif",fontSize:"12px"},textUtil=new TextUtil({style:LABEL_STYLE,size:{width:100}}),markers={},handlers={"bpmn:Event":function(p,element,attrs){return drawCircle(p,element.width,element.height,attrs)},"bpmn:StartEvent":function(p,element){var attrs={},semantic=getSemantic(element);semantic.isInterrupting||(attrs={strokeDasharray:"6",strokeLinecap:"round"});var circle=renderer("bpmn:Event")(p,element,attrs);return renderEventContent(element,p),circle},"bpmn:MessageEventDefinition":function(p,element,isThrowing){var pathData=pathMap.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:element.width,containerHeight:element.height,position:{mx:.235,my:.315}}),fill=isThrowing?"black":"white",stroke=isThrowing?"white":"black",messagePath=drawPath(p,pathData,{strokeWidth:1,fill:fill,stroke:stroke});return messagePath},"bpmn:TimerEventDefinition":function(p,element){for(var circle=drawCircle(p,element.width,element.height,.2*element.height,{strokeWidth:2}),pathData=pathMap.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),i=(drawPath(p,pathData,{strokeWidth:2,strokeLinecap:"square"}),0);12>i;i++){var linePathData=pathMap.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),width=element.width/2,height=element.height/2;drawPath(p,linePathData,{strokeWidth:1,strokeLinecap:"square",transform:"rotate("+30*i+","+height+","+width+")"})}return circle},"bpmn:EscalationEventDefinition":function(p,event,isThrowing){var pathData=pathMap.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.555}}),fill=isThrowing?"black":"none";return drawPath(p,pathData,{strokeWidth:1,fill:fill})},"bpmn:ConditionalEventDefinition":function(p,event){var pathData=pathMap.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.222}});return drawPath(p,pathData,{strokeWidth:1})},"bpmn:LinkEventDefinition":function(p,event){var pathData=pathMap.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.57,my:.263}});return drawPath(p,pathData,{strokeWidth:1})},"bpmn:ErrorEventDefinition":function(p,event,isThrowing){var pathData=pathMap.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.2,my:.722}}),fill=isThrowing?"black":"none";return drawPath(p,pathData,{strokeWidth:1,fill:fill})},"bpmn:CancelEventDefinition":function(p,event,isThrowing){var pathData=pathMap.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.638,my:-.055}}),fill=isThrowing?"black":"none";return drawPath(p,pathData,{strokeWidth:1,fill:fill}).transform("rotate(45)")},"bpmn:CompensateEventDefinition":function(p,event,isThrowing){var pathData=pathMap.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.201,my:.472}}),fill=isThrowing?"black":"none";return drawPath(p,pathData,{strokeWidth:1,fill:fill})},"bpmn:SignalEventDefinition":function(p,event,isThrowing){var pathData=pathMap.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.2}}),fill=isThrowing?"black":"none";return drawPath(p,pathData,{strokeWidth:1,fill:fill})},"bpmn:MultipleEventDefinition":function(p,event,isThrowing){var pathData=pathMap.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.222,my:.36}}),fill=isThrowing?"black":"none";return drawPath(p,pathData,{strokeWidth:1,fill:fill})},"bpmn:ParallelMultipleEventDefinition":function(p,event){var pathData=pathMap.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:event.width,containerHeight:event.height,position:{mx:.458,my:.194}});return drawPath(p,pathData,{strokeWidth:1})},"bpmn:EndEvent":function(p,element){var circle=renderer("bpmn:Event")(p,element,{strokeWidth:4});return renderEventContent(element,p,!0),circle},"bpmn:TerminateEventDefinition":function(p,element){var circle=drawCircle(p,element.width,element.height,8,{strokeWidth:4,fill:"black"});return circle},"bpmn:IntermediateEvent":function(p,element){{var outer=renderer("bpmn:Event")(p,element,{strokeWidth:1});drawCircle(p,element.width,element.height,INNER_OUTER_DIST,{strokeWidth:1,fill:"none"})}return renderEventContent(element,p),outer},"bpmn:IntermediateCatchEvent":as("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":as("bpmn:IntermediateEvent"),"bpmn:Activity":function(p,element,attrs){return drawRect(p,element.width,element.height,TASK_BORDER_RADIUS,attrs)},"bpmn:Task":function(p,element){var rect=renderer("bpmn:Activity")(p,element);return renderEmbeddedLabel(p,element,"center-middle"),attachTaskMarkers(p,element),rect},"bpmn:ServiceTask":function(p,element){{var task=renderer("bpmn:Task")(p,element),pathDataBG=pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}}),fillPathData=(drawPath(p,pathDataBG,{strokeWidth:1,fill:"none"}),pathMap.getScaledPath("TASK_TYPE_SERVICE_FILL",{abspos:{x:17.2,y:18}})),pathData=(drawPath(p,fillPathData,{strokeWidth:0,stroke:"none",fill:"white"}),pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}}));drawPath(p,pathData,{strokeWidth:1,fill:"white"})}return task},"bpmn:UserTask":function(p,element){{var task=renderer("bpmn:Task")(p,element),x=15,y=12,pathData=pathMap.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:x,y:y}}),pathData2=(drawPath(p,pathData,{strokeWidth:.5,fill:"none"}),pathMap.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:x,y:y}})),pathData3=(drawPath(p,pathData2,{strokeWidth:.5,fill:"none"}),pathMap.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:x,y:y}}));drawPath(p,pathData3,{strokeWidth:.5,fill:"black"})}return task},"bpmn:ManualTask":function(p,element){{var task=renderer("bpmn:Task")(p,element),pathData=pathMap.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}});drawPath(p,pathData,{strokeWidth:.25,fill:"white",stroke:"black"})}return task},"bpmn:SendTask":function(p,element){{var task=renderer("bpmn:Task")(p,element),pathData=pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}});drawPath(p,pathData,{strokeWidth:1,fill:"black",stroke:"white"})}return task},"bpmn:ReceiveTask":function(p,element){var pathData,semantic=getSemantic(element),task=renderer("bpmn:Task")(p,element);semantic.instantiate?(drawCircle(p,28,28,4.4,{strokeWidth:1}),pathData=pathMap.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):pathData=pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}});drawPath(p,pathData,{strokeWidth:1});return task},"bpmn:ScriptTask":function(p,element){{var task=renderer("bpmn:Task")(p,element),pathData=pathMap.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}});drawPath(p,pathData,{strokeWidth:1})}return task},"bpmn:BusinessRuleTask":function(p,element){var task=renderer("bpmn:Task")(p,element),headerPathData=pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}}),businessHeaderPath=drawPath(p,headerPathData);businessHeaderPath.attr({strokeWidth:1,fill:"AAA"});var headerData=pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}}),businessPath=drawPath(p,headerData);return businessPath.attr({strokeWidth:1}),task},"bpmn:SubProcess":function(p,element,attrs){var rect=renderer("bpmn:Activity")(p,element,attrs),semantic=getSemantic(element),expanded=(getDi(element),DiUtil.isExpanded(semantic)),isEventSubProcess=!!semantic.triggeredByEvent;return isEventSubProcess&&rect.attr({strokeDasharray:"1,2"}),renderEmbeddedLabel(p,element,expanded?"center-top":"center-middle"),expanded?attachTaskMarkers(p,element):attachTaskMarkers(p,element,["SubProcessMarker"]),rect},"bpmn:AdHocSubProcess":function(p,element){return renderer("bpmn:SubProcess")(p,element)},"bpmn:Transaction":function(p,element){{var outer=renderer("bpmn:SubProcess")(p,element),innerAttrs=styles.style(["no-fill","no-events"]);drawRect(p,element.width,element.height,TASK_BORDER_RADIUS-2,INNER_OUTER_DIST,innerAttrs)}return outer},"bpmn:CallActivity":function(p,element){return renderer("bpmn:SubProcess")(p,element,{strokeWidth:5})},"bpmn:Participant":function(p,element){var lane=renderer("bpmn:Lane")(p,element),expandedPool=DiUtil.isExpandedPool(getSemantic(element));if(expandedPool){drawLine(p,[{x:30,y:0},{x:30,y:element.height}]);var text=getSemantic(element).name;renderLaneLabel(p,text,element)}else{var text2=getSemantic(element).name;renderLabel(p,text2,{box:element,align:"center-middle"})}var participantMultiplicity=!!getSemantic(element).participantMultiplicity;return participantMultiplicity&&renderer("ParticipantMultiplicityMarker")(p,element),lane},"bpmn:Lane":function(p,element){var rect=drawRect(p,element.width,element.height,0,{fill:"none"}),semantic=getSemantic(element);if("bpmn:Lane"===semantic.$type){var text=semantic.name;renderLaneLabel(p,text,element)}return rect},"bpmn:InclusiveGateway":function(p,element){{var diamond=drawDiamond(p,element.width,element.height);drawCircle(p,element.width,element.height,.24*element.height,{strokeWidth:2.5,fill:"none"})}return diamond},"bpmn:ExclusiveGateway":function(p,element){var diamond=drawDiamond(p,element.width,element.height),pathData=pathMap.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.32,my:.3}});return getDi(element).isMarkerVisible&&drawPath(p,pathData,{strokeWidth:1,fill:"black"}),diamond},"bpmn:ComplexGateway":function(p,element){{var diamond=drawDiamond(p,element.width,element.height),pathData=pathMap.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.26}});drawPath(p,pathData,{strokeWidth:1,fill:"black"})}return diamond},"bpmn:ParallelGateway":function(p,element){{var diamond=drawDiamond(p,element.width,element.height),pathData=pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.2}});drawPath(p,pathData,{strokeWidth:1,fill:"black"})}return diamond},"bpmn:EventBasedGateway":function(p,element){function drawEvent(){{var pathData=pathMap.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:element.width,containerHeight:element.height,position:{mx:.36,my:.44}});drawPath(p,pathData,{strokeWidth:2,fill:"none"})}}var semantic=getSemantic(element),diamond=drawDiamond(p,element.width,element.height),type=(drawCircle(p,element.width,element.height,.2*element.height,{strokeWidth:1,fill:"none"}),semantic.eventGatewayType),instantiate=!!semantic.instantiate;if("Parallel"===type){var pathData=pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}}),parallelPath=drawPath(p,pathData);parallelPath.attr({strokeWidth:1,fill:"none"})}else if("Exclusive"===type){if(!instantiate){var innerCircle=drawCircle(p,element.width,element.height,.26*element.height);innerCircle.attr({strokeWidth:1,fill:"none"})}drawEvent()}return diamond},"bpmn:Gateway":function(p,element){return drawDiamond(p,element.width,element.height)},"bpmn:SequenceFlow":function(p,element){var pathData=createPathFromConnection(element),path=drawPath(p,pathData,{markerEnd:marker("sequenceflow-end")}),sequenceFlow=getSemantic(element),source=element.source.businessObject;return sequenceFlow.conditionExpression&&source.$instanceOf("bpmn:Task")&&path.attr({markerStart:marker("conditional-flow-marker")}),source["default"]&&source.$instanceOf("bpmn:Gateway")&&source["default"]===sequenceFlow&&path.attr({markerStart:marker("conditional-default-flow-marker")}),path},"bpmn:Association":function(p,element,attrs){return attrs=_.extend({strokeDasharray:"1,6",strokeLinecap:"round"},attrs||{}),drawLine(p,element.waypoints,attrs)},"bpmn:DataInputAssociation":function(p,element){return renderer("bpmn:Association")(p,element,{markerEnd:marker("data-association-end")})},"bpmn:DataOutputAssociation":function(p,element){return renderer("bpmn:Association")(p,element,{markerEnd:marker("data-association-end")})},"bpmn:MessageFlow":function(p,element){var di=getDi(element),pathData=createPathFromConnection(element),path=drawPath(p,pathData,{markerEnd:marker("messageflow-end"),markerStart:marker("messageflow-start"),strokeDasharray:"10",strokeLinecap:"round",strokeWidth:1});if(di.messageVisibleKind){var midPoint=path.getPointAtLength(path.getTotalLength()/2),markerPathData=pathMap.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:midPoint.x,y:midPoint.y}}),messageAttrs={strokeWidth:1};"initiating"===di.messageVisibleKind?(messageAttrs.fill="white",messageAttrs.stroke="black"):(messageAttrs.fill="#888",messageAttrs.stroke="white"),drawPath(p,markerPathData,messageAttrs)}return path},"bpmn:DataObject":function(p,element){var pathData=pathMap.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}}),elementObject=drawPath(p,pathData,{fill:"white"}),semantic=getSemantic(element);return isCollection(semantic)&&renderDataItemCollection(p,element),elementObject},"bpmn:DataObjectReference":as("bpmn:DataObject"),"bpmn:DataInput":function(p,element){{var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(p,element);drawPath(p,arrowPathData,{strokeWidth:1})}return elementObject},"bpmn:DataOutput":function(p,element){{var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(p,element);drawPath(p,arrowPathData,{strokeWidth:1,fill:"black"})}return elementObject},"bpmn:DataStoreReference":function(p,element){var DATA_STORE_PATH=pathMap.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:.133}}),elementStore=drawPath(p,DATA_STORE_PATH,{strokeWidth:2,fill:"white"});return elementStore},"bpmn:BoundaryEvent":function(p,element){var semantic=getSemantic(element),cancel=semantic.cancelActivity,attrs={strokeLinecap:"round",strokeWidth:1};cancel||(attrs.strokeDasharray="6");{var outer=renderer("bpmn:Event")(p,element,attrs);drawCircle(p,element.width,element.height,INNER_OUTER_DIST,attrs)}return renderEventContent(element,p),outer},"bpmn:Group":function(p,element){return drawRect(p,element.width,element.height,TASK_BORDER_RADIUS,{strokeWidth:1,strokeDasharray:"8,3,1,3",fill:"none",pointerEvents:"none"})},label:function(p,element){return renderExternalLabel(p,element,"")},"bpmn:TextAnnotation":function(p,element){var style={fill:"none",stroke:"none"},textElement=drawRect(p,element.width,element.height,0,0,style),textPathData=pathMap.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:0}});drawPath(p,textPathData);var text=getSemantic(element).text||"";return renderLabel(p,text,{box:element,align:"left-middle",padding:5}),textElement},ParticipantMultiplicityMarker:function(p,element){var subProcessPath=pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:element.width/2/element.width,my:(element.height-15)/element.height}});drawPath(p,subProcessPath)},SubProcessMarker:function(p,element){var markerRect=drawRect(p,14,14,0,{strokeWidth:1});markerRect.transform("translate("+(element.width/2-7.5)+","+(element.height-20)+")");var subProcessPath=pathMap.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2-7.5)/element.width,my:(element.height-20)/element.height}});drawPath(p,subProcessPath)},ParallelMarker:function(p,element,position){var subProcessPath=pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.parallel)/element.width,my:(element.height-20)/element.height}});drawPath(p,subProcessPath)},SequentialMarker:function(p,element,position){var sequentialPath=pathMap.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.seq)/element.width,my:(element.height-19)/element.height}});drawPath(p,sequentialPath)},CompensationMarker:function(p,element,position){var compensationPath=pathMap.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.compensation)/element.width,my:(element.height-13)/element.height}});drawPath(p,compensationPath,{strokeWidth:1})},LoopMarker:function(p,element,position){var loopPath=pathMap.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.loop)/element.width,my:(element.height-7)/element.height}});drawPath(p,loopPath,{strokeWidth:1,fill:"none",strokeLinecap:"round",strokeMiterlimit:.5})},AdhocMarker:function(p,element,position){var loopPath=pathMap.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.adhoc)/element.width,my:(element.height-15)/element.height}});drawPath(p,loopPath,{strokeWidth:1,fill:"black"})
}};events.on("canvas.init",function(event){initMarkers(event.svg)}),this.drawShape=drawShape,this.drawConnection=drawConnection}var _=window._,DefaultRenderer=_dereq_("diagram-js/lib/draw/Renderer"),TextUtil=_dereq_("diagram-js/lib/util/Text"),DiUtil=_dereq_("../util/Di"),createLine=DefaultRenderer.createLine;BpmnRenderer.prototype=Object.create(DefaultRenderer.prototype),BpmnRenderer.$inject=["eventBus","styles","pathMap"],module.exports=BpmnRenderer},{"../util/Di":12,"diagram-js/lib/draw/Renderer":43,"diagram-js/lib/util/Text":64}],5:[function(_dereq_,module){"use strict";function PathMap(Snap){this.pathMap={EVENT_MESSAGE:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:"m {mx},{my} c -{e.x1},{e.y0} -{e.x3},{e.y1} -{e.x5},{e.y4} {e.x1},-{e.y3} {e.x3},-{e.y5} {e.x5},-{e.y6} {e.x0},{e.y3} {e.x2},{e.y5} {e.x4},{e.y6} -{e.x0},-{e.y0} -{e.x2},-{e.y1} -{e.x4},-{e.y4} z",height:36,width:36,heightElements:[2.382,4.764,4.926,6.589333,7.146,13.178667,19.768],widthElements:[2.463,2.808,4.926,5.616,7.389,8.424]},EVENT_CONDITIONAL:{d:"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z",height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x0},0 {e.x0},-{e.y0} 0,{e.y1} z",height:36,width:36,heightElements:[5,10],widthElements:[10]},EVENT_TIMER_WH:{d:"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:"m {mx}, {my} m  0 15  l 0 -15 m  4 15  l 0 -15 m  4 15  l 0 -15 ",height:61,width:51,heightElements:[12],widthElements:[1,6,12,15]},DATA_ARROW:{d:"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:"m {mx},{my} 8,-5 0,10 z m 9,0 8,-5 0,10 z",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5"},TASK_TYPE_USER_2:{d:"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 "},TASK_TYPE_USER_3:{d:"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z"},TASK_TYPE_MANUAL:{d:"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z"},TASK_TYPE_INSTANTIATING_SEND:{d:"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6"},TASK_TYPE_SERVICE:{d:"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_SERVICE_FILL:{d:"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:"m {mx},{my} 0,4 20,0 0,-4 z"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"},MESSAGE_FLOW_MARKER:{d:"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6"}},this.getRawPath=function(pathId){return this.pathMap[pathId].d},this.getScaledPath=function(pathId,param){var mx,my,rawPath=this.pathMap[pathId];param.abspos?(mx=param.abspos.x,my=param.abspos.y):(mx=param.containerWidth*param.position.mx,my=param.containerHeight*param.position.my);var coordinates={};if(param.position){for(var heightRatio=param.containerHeight/rawPath.height*param.yScaleFactor,widthRatio=param.containerWidth/rawPath.width*param.xScaleFactor,heightIndex=0;heightIndex<rawPath.heightElements.length;heightIndex++)coordinates["y"+heightIndex]=rawPath.heightElements[heightIndex]*heightRatio;for(var widthIndex=0;widthIndex<rawPath.widthElements.length;widthIndex++)coordinates["x"+widthIndex]=rawPath.widthElements[widthIndex]*widthRatio}var path=Snap.format(rawPath.d,{mx:mx,my:my,e:coordinates});return path}}PathMap.$inject=["snap"],module.exports=PathMap},{}],6:[function(_dereq_,module){module.exports={renderer:["type",_dereq_("./BpmnRenderer")],pathMap:["type",_dereq_("./PathMap")]}},{"./BpmnRenderer":4,"./PathMap":5}],7:[function(_dereq_,module){"use strict";function elementData(semantic,attrs){return _.extend({id:semantic.id,type:semantic.$type,businessObject:semantic},attrs)}function collectWaypoints(waypoints){return _.collect(waypoints,function(p){return{x:p.x,y:p.y}})}function BpmnImporter(eventBus,canvas,elementFactory,elementRegistry){this._eventBus=eventBus,this._canvas=canvas,this._elementFactory=elementFactory,this._elementRegistry=elementRegistry}var _=window._,LabelUtil=_dereq_("../util/Label"),hasExternalLabel=LabelUtil.hasExternalLabel,getExternalLabelBounds=LabelUtil.getExternalLabelBounds,isExpanded=_dereq_("../util/Di").isExpanded,elementToString=_dereq_("./Util").elementToString;BpmnImporter.$inject=["eventBus","canvas","elementFactory","elementRegistry"],module.exports=BpmnImporter,BpmnImporter.prototype.add=function(semantic,parentElement){var element,di=semantic.di;if(di.$instanceOf("bpmndi:BPMNPlane"))element=this._elementFactory.createRoot(elementData(semantic)),this._canvas.setRootElement(element);else if(di.$instanceOf("bpmndi:BPMNShape")){var collapsed=!isExpanded(semantic),hidden=parentElement&&(parentElement.hidden||parentElement.collapsed),bounds=semantic.di.bounds;element=this._elementFactory.createShape(elementData(semantic,{collapsed:collapsed,hidden:hidden,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)})),this._canvas.addShape(element,parentElement)}else{if(!di.$instanceOf("bpmndi:BPMNEdge"))throw new Error("unknown di "+elementToString(di)+" for element "+elementToString(semantic));var source=this._getSource(semantic),target=this._getTarget(semantic);element=this._elementFactory.createConnection(elementData(semantic,{source:source,target:target,waypoints:collectWaypoints(semantic.di.waypoint)})),this._canvas.addConnection(element,parentElement)}return hasExternalLabel(semantic)&&this.addLabel(semantic,element),this._eventBus.fire("bpmnElement.added",{element:element}),element},BpmnImporter.prototype.addLabel=function(semantic,element){var bounds=getExternalLabelBounds(semantic,element),label=this._elementFactory.createLabel(elementData(semantic,{id:semantic.id+"_label",labelTarget:element,type:"label",hidden:element.hidden,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}));return this._canvas.addShape(label,element.parent)},BpmnImporter.prototype._getEnd=function(semantic,side){var element,refSemantic,type=semantic.$type;if(refSemantic=semantic[side+"Ref"],"source"===side&&"bpmn:DataInputAssociation"===type&&(refSemantic=refSemantic&&refSemantic[0]),("source"===side&&"bpmn:DataOutputAssociation"===type||"target"===side&&"bpmn:DataInputAssociation"===type)&&(refSemantic=semantic.$parent),element=refSemantic&&this._getElement(refSemantic))return element;throw new Error(refSemantic?"element "+elementToString(refSemantic)+" referenced by "+elementToString(semantic)+"#"+side+"Ref not yet drawn":elementToString(semantic)+"#"+side+"Ref not specified")},BpmnImporter.prototype._getSource=function(semantic){return this._getEnd(semantic,"source")},BpmnImporter.prototype._getTarget=function(semantic){return this._getEnd(semantic,"target")},BpmnImporter.prototype._getElement=function(semantic){return this._elementRegistry.get(semantic.id)}},{"../util/Di":12,"../util/Label":13,"./Util":10}],8:[function(_dereq_,module){"use strict";function findDisplayCandidate(definitions){return _.find(definitions.rootElements,function(e){return e.$instanceOf("bpmn:Process")||e.$instanceOf("bpmn:Collaboration")})}function BpmnTreeWalker(handler){function contextual(fn,ctx){return function(e){fn(e,ctx)}}function is(element,type){return element.$instanceOf(type)}function visit(element,ctx){var gfx=element.gfx;if(gfx)throw new Error("already rendered "+elementToString(element));return handler.element(element,ctx)}function visitRoot(element,diagram){return handler.root(element,diagram)}function visitIfDi(element,ctx){try{return element.di&&visit(element,ctx)}catch(e){logError(e.message,{element:element,error:e}),console.error("failed to import "+elementToString(element)),console.error(e)}}function logError(message,context){handler.error(message,context)}function registerDi(di){var bpmnElement=di.bpmnElement;bpmnElement?bpmnElement.di?logError("multiple DI elements defined for "+elementToString(bpmnElement),{element:bpmnElement}):(diRefs.bind(bpmnElement,"di"),bpmnElement.di=di):logError("no bpmnElement referenced in "+elementToString(di),{element:di})}function handleDiagram(diagram){handlePlane(diagram.plane)}function handlePlane(plane){registerDi(plane),_.forEach(plane.planeElement,handlePlaneElement)}function handlePlaneElement(planeElement){registerDi(planeElement)}function handleDefinitions(definitions,diagram){var diagrams=definitions.diagrams;if(diagram&&-1===diagrams.indexOf(diagram))throw new Error("diagram not part of bpmn:Definitions");if(!diagram&&diagrams&&diagrams.length&&(diagram=diagrams[0]),diagram){handleDiagram(diagram);var plane=diagram.plane;if(!plane)throw new Error("no plane for "+elementToString(diagram));var rootElement=plane.bpmnElement;if(!rootElement){if(rootElement=findDisplayCandidate(definitions),!rootElement)throw new Error("do not know what to display");logError("correcting missing bpmnElement on "+elementToString(plane)+" to "+elementToString(rootElement)),plane.bpmnElement=rootElement,registerDi(plane)}var ctx=visitRoot(rootElement,plane);if(is(rootElement,"bpmn:Process"))handleProcess(rootElement,ctx);else{if(!is(rootElement,"bpmn:Collaboration"))throw new Error("unsupported bpmnElement for "+elementToString(plane)+" : "+elementToString(rootElement));handleCollaboration(rootElement,ctx),handleUnhandledProcesses(definitions.rootElements,ctx)}handleDeferred(deferred)}}function handleDeferred(deferred){_.forEach(deferred,function(d){d()})}function handleProcess(process,context){handleFlowElementsContainer(process,context),handleIoSpecification(process.ioSpecification,context),handleArtifacts(process.artifacts,context),handledProcesses.push(process)}function handleUnhandledProcesses(rootElements){var processes=_.filter(rootElements,function(e){return is(e,"bpmn:Process")&&e.laneSets&&-1===handledProcesses.indexOf(e)});processes.forEach(contextual(handleProcess))}function handleMessageFlow(messageFlow,context){visitIfDi(messageFlow,context)}function handleMessageFlows(messageFlows,context){_.forEach(messageFlows,contextual(handleMessageFlow,context))}function handleDataAssociation(association,context){visitIfDi(association,context)}function handleDataInput(dataInput,context){visitIfDi(dataInput,context)}function handleDataOutput(dataOutput,context){visitIfDi(dataOutput,context)}function handleArtifact(artifact,context){visitIfDi(artifact,context)}function handleArtifacts(artifacts,context){_.forEach(artifacts,function(e){is(e,"bpmn:Association")?deferred.push(function(){handleArtifact(e,context)}):handleArtifact(e,context)})}function handleIoSpecification(ioSpecification,context){ioSpecification&&(_.forEach(ioSpecification.dataInputs,contextual(handleDataInput,context)),_.forEach(ioSpecification.dataOutputs,contextual(handleDataOutput,context)))}function handleSubProcess(subProcess,context){handleFlowElementsContainer(subProcess,context),handleArtifacts(subProcess.artifacts,context)}function handleFlowNode(flowNode,context){var childCtx=visitIfDi(flowNode,context);is(flowNode,"bpmn:SubProcess")&&handleSubProcess(flowNode,childCtx||context)}function handleSequenceFlow(sequenceFlow,context){visitIfDi(sequenceFlow,context)}function handleDataElement(dataObject,context){visitIfDi(dataObject,context)}function handleBoundaryEvent(dataObject,context){visitIfDi(dataObject,context)}function handleLane(lane,context){var newContext=visitIfDi(lane,context);if(lane.childLaneSet)handleLaneSet(lane.childLaneSet,newContext||context);else{var filterList=_.filter(lane.flowNodeRef,function(e){return"bpmn:BoundaryEvent"!==e.$type});handleFlowElements(filterList,newContext||context)}}function handleLaneSet(laneSet,context){_.forEach(laneSet.lanes,contextual(handleLane,context))}function handleLaneSets(laneSets,context){_.forEach(laneSets,contextual(handleLaneSet,context))}function handleFlowElementsContainer(container,context){container.laneSets?(handleLaneSets(container.laneSets,context),handleNonFlowNodes(container.flowElements)):handleFlowElements(container.flowElements,context)}function handleNonFlowNodes(flowElements,context){_.forEach(flowElements,function(e){is(e,"bpmn:SequenceFlow")?deferred.push(function(){handleSequenceFlow(e,context)}):is(e,"bpmn:BoundaryEvent")?deferred.unshift(function(){handleBoundaryEvent(e,context)}):is(e,"bpmn:DataObject")||(is(e,"bpmn:DataStoreReference")?handleDataElement(e,context):is(e,"bpmn:DataObjectReference")&&handleDataElement(e,context))})}function handleFlowElements(flowElements,context){_.forEach(flowElements,function(e){is(e,"bpmn:SequenceFlow")?deferred.push(function(){handleSequenceFlow(e,context)}):is(e,"bpmn:BoundaryEvent")?deferred.unshift(function(){handleBoundaryEvent(e,context)}):is(e,"bpmn:FlowNode")?(handleFlowNode(e,context),is(e,"bpmn:Activity")&&(handleIoSpecification(e.ioSpecification,context),deferred.push(function(){_.forEach(e.dataInputAssociations,contextual(handleDataAssociation,context)),_.forEach(e.dataOutputAssociations,contextual(handleDataAssociation,context))}))):is(e,"bpmn:DataObject")||(is(e,"bpmn:DataStoreReference")?handleDataElement(e,context):is(e,"bpmn:DataObjectReference")?handleDataElement(e,context):logError("unrecognized flowElement "+elementToString(e)+" in context "+(context?elementToString(context.businessObject):null),{element:e,context:context}))})}function handleParticipant(participant,context){var newCtx=visitIfDi(participant,context),process=participant.processRef;process&&handleProcess(process,newCtx||context)}function handleCollaboration(collaboration){_.forEach(collaboration.participants,contextual(handleParticipant)),handleArtifacts(collaboration.artifacts),handleMessageFlows(collaboration.messageFlows)}var handledProcesses=[],deferred=[];return{handleDefinitions:handleDefinitions}}var _=window._,Refs=_dereq_("object-refs"),elementToString=_dereq_("./Util").elementToString,diRefs=new Refs({name:"bpmnElement",enumerable:!0},{name:"di"});module.exports=BpmnTreeWalker},{"./Util":10,"object-refs":69}],9:[function(_dereq_,module){"use strict";function importBpmnDiagram(diagram,definitions,done){function parse(definitions){var visitor={root:function(element){return importer.add(element)},element:function(element,parentShape){return importer.add(element,parentShape)},error:function(message,context){warnings.push({message:message,context:context})}},walker=new BpmnTreeWalker(visitor);walker.handleDefinitions(definitions)}var error,importer=diagram.get("bpmnImporter"),eventBus=diagram.get("eventBus"),warnings=[];eventBus.fire("import.start");try{parse(definitions)}catch(e){error=e}eventBus.fire(error?"import.error":"import.success",{error:error,warnings:warnings}),done(error,warnings)}var BpmnTreeWalker=_dereq_("./BpmnTreeWalker");module.exports.importBpmnDiagram=importBpmnDiagram},{"./BpmnTreeWalker":8}],10:[function(_dereq_,module){module.exports.elementToString=function(e){return e?"<"+e.$type+(e.id?' id="'+e.id:"")+'" />':"<null>"}},{}],11:[function(_dereq_,module){module.exports={bpmnImporter:["type",_dereq_("./BpmnImporter")]}},{"./BpmnImporter":7}],12:[function(_dereq_,module){"use strict";module.exports.isExpandedPool=function(semantic){return!!semantic.processRef},module.exports.isExpanded=function(semantic){var isDefaultExpanded=!(semantic.$instanceOf("bpmn:SubProcess")||semantic.$instanceOf("bpmn:CallActivity")),isExpanded=isDefaultExpanded||semantic.di.isExpanded;return isExpanded}},{}],13:[function(_dereq_,module){"use strict";var _=window._,DEFAULT_LABEL_SIZE=module.exports.DEFAULT_LABEL_SIZE={width:90,height:20};module.exports.hasExternalLabel=function(semantic){return semantic.$instanceOf("bpmn:Event")||semantic.$instanceOf("bpmn:Gateway")||semantic.$instanceOf("bpmn:DataStoreReference")||semantic.$instanceOf("bpmn:DataObjectReference")||semantic.$instanceOf("bpmn:SequenceFlow")||semantic.$instanceOf("bpmn:MessageFlow")};var getWaypointsMid=module.exports.getWaypointsMid=function(waypoints){var mid=waypoints.length/2-1,first=waypoints[Math.floor(mid)],second=waypoints[Math.ceil(mid+.01)];return{x:first.x+(second.x-first.x)/2,y:first.y+(second.y-first.y)/2}},getExternalLabelMid=module.exports.getExternalLabelMid=function(element){return element.waypoints?getWaypointsMid(element.waypoints):{x:element.x+element.width/2,y:element.y+element.height+DEFAULT_LABEL_SIZE.height/2}};module.exports.getExternalLabelBounds=function(semantic,element){var mid,size,bounds,di=semantic.di,label=di.label;return label&&label.bounds?(bounds=label.bounds,size={width:Math.max(DEFAULT_LABEL_SIZE.width,bounds.width),height:bounds.height},mid={x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}):(mid=getExternalLabelMid(element),size=DEFAULT_LABEL_SIZE),_.extend({x:mid.x-size.width/2,y:mid.y-size.height/2},size)}},{}],14:[function(_dereq_,module){module.exports=_dereq_("./lib/simple")},{"./lib/simple":16}],15:[function(_dereq_,module){"use strict";function BpmnModdle(packages,options){Moddle.call(this,packages,options)}var _=window._,Moddle=_dereq_("moddle"),ModdleXml=_dereq_("moddle-xml");BpmnModdle.prototype=Object.create(Moddle.prototype),module.exports=BpmnModdle,BpmnModdle.prototype.fromXML=function(xmlStr,typeName,options,done){_.isString(typeName)||(done=options,options=typeName,typeName="bpmn:Definitions"),_.isFunction(options)&&(done=options,options={});var reader=new ModdleXml.Reader(this,options),rootHandler=reader.handler(typeName);reader.fromXML(xmlStr,rootHandler,done)},BpmnModdle.prototype.toXML=function(element,options,done){_.isFunction(options)&&(done=options,options={});var writer=new ModdleXml.Writer(options);try{var result=writer.toXML(element);done(null,result)}catch(e){done(e)}}},{moddle:22,"moddle-xml":17}],16:[function(_dereq_,module){var BpmnModdle=_dereq_("./bpmn-moddle"),packages={bpmn:_dereq_("../resources/bpmn/json/bpmn.json"),bpmndi:_dereq_("../resources/bpmn/json/bpmndi.json"),dc:_dereq_("../resources/bpmn/json/dc.json"),di:_dereq_("../resources/bpmn/json/di.json")};module.exports=function(){return new BpmnModdle(packages)}},{"../resources/bpmn/json/bpmn.json":31,"../resources/bpmn/json/bpmndi.json":32,"../resources/bpmn/json/dc.json":33,"../resources/bpmn/json/di.json":34,"./bpmn-moddle":15}],17:[function(_dereq_,module){"use strict";module.exports.Reader=_dereq_("./lib/Reader"),module.exports.Writer=_dereq_("./lib/Writer")},{"./lib/Reader":18,"./lib/Writer":19}],18:[function(_dereq_,module){"use strict";function parseNodeAttributes(node){var nodeAttrs=node.attributes;return _.reduce(nodeAttrs,function(result,v){var name,ns;return v.local?(ns=parseNameNs(v.name,v.prefix),name=ns.name):name=v.prefix,result[name]=v.value,result},{})}function normalizeNamespaces(node,model,defaultNsUri){var uri,prefix;if(uri=node.uri||defaultNsUri){var pkg=model.getPackage(uri);prefix=pkg?pkg.prefix:node.prefix,node.prefix=prefix,node.uri=uri}_.forEach(node.attributes,function(attr){normalizeNamespaces(attr,model,null)})}function Context(parseRoot){var elementsById={},references=[],warnings=[];this.addReference=function(reference){references.push(reference)},this.addElement=function(id,element){if(!id||!element)throw new Error("[xml-reader] id or ctx must not be null");elementsById[id]=element},this.addWarning=function(w){warnings.push(w)},this.warnings=warnings,this.references=references,this.elementsById=elementsById,this.parseRoot=parseRoot}function BaseHandler(){}function BodyHandler(){}function ReferenceHandler(property,context){this.property=property,this.context=context}function ValueHandler(propertyDesc,element){this.element=element,this.propertyDesc=propertyDesc}function BaseElementHandler(){}function ElementHandler(model,type,context){this.model=model,this.type=model.getType(type),this.context=context}function GenericElementHandler(model,type,context){this.model=model,this.context=context}function XMLReader(model){this.model=model}var sax=window.sax,_=window._,common=_dereq_("./common"),Types=_dereq_("moddle").types,Stack=_dereq_("tiny-stack"),parseNameNs=_dereq_("moddle").ns.parseName,aliasToName=common.aliasToName;BaseHandler.prototype.handleEnd=function(){},BaseHandler.prototype.handleText=function(){},BaseHandler.prototype.handleNode=function(){},BodyHandler.prototype=new BaseHandler,BodyHandler.prototype.handleText=function(text){this.body=(this.body||"")+text},ReferenceHandler.prototype=new BodyHandler,ReferenceHandler.prototype.handleNode=function(node){if(this.element)throw new Error("expected no sub nodes");return this.element=this.createReference(node),this},ReferenceHandler.prototype.handleEnd=function(){this.element.id=this.body},ReferenceHandler.prototype.createReference=function(){return{property:this.property.ns.name,id:""}},ValueHandler.prototype=new BodyHandler,ValueHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,propertyDesc=this.propertyDesc;value=Types.coerceType(propertyDesc.type,value),propertyDesc.isMany?element.get(propertyDesc.name).push(value):element.set(propertyDesc.name,value)},BaseElementHandler.prototype=Object.create(BodyHandler.prototype),BaseElementHandler.prototype.handleNode=function(node){var parser=this;if(this.element)parser=this.handleChild(node);else{this.element=this.createElement(node);var id=this.element.id;id&&this.context.addElement(id,this.element)}return parser},ElementHandler.prototype=new BaseElementHandler,ElementHandler.prototype.addReference=function(reference){this.context.addReference(reference)},ElementHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,descriptor=element.$descriptor,bodyProperty=descriptor.bodyProperty;bodyProperty&&void 0!==value&&(value=Types.coerceType(bodyProperty.type,value),element.set(bodyProperty.name,value))},ElementHandler.prototype.createElement=function(node){var attributes=parseNodeAttributes(node),Type=this.type,descriptor=Type.$descriptor,context=this.context,instance=new Type({});return _.forEach(attributes,function(value,name){var prop=descriptor.propertiesByName[name];prop&&prop.isReference?context.addReference({element:instance,property:prop.ns.name,id:value}):(prop&&(value=Types.coerceType(prop.type,value)),instance.set(name,value))}),instance},ElementHandler.prototype.getPropertyForElement=function(nameNs){_.isString(nameNs)&&(nameNs=parseNameNs(nameNs));var type=this.type,model=this.model,descriptor=type.$descriptor,propertyName=nameNs.name,property=descriptor.propertiesByName[propertyName];if(property)return property;var pkg=model.getPackage(nameNs.prefix);if(pkg){var typeName=nameNs.prefix+":"+aliasToName(nameNs.localName,descriptor.$pkg),elementType=model.getType(typeName);if(property=_.find(descriptor.properties,function(p){return!p.isVirtual&&!p.isReference&&!p.isAttribute&&elementType.hasType(p.type)}))return _.extend({},property,{effectiveType:elementType.$descriptor.name})}else if(property=_.find(descriptor.properties,function(p){return!p.isReference&&!p.isAttribute&&"Element"===p.type}))return property;throw new Error("unrecognized element <"+nameNs.name+">")},ElementHandler.prototype.toString=function(){return"ElementDescriptor["+this.type.$descriptor.name+"]"},ElementHandler.prototype.valueHandler=function(propertyDesc,element){return new ValueHandler(propertyDesc,element)},ElementHandler.prototype.referenceHandler=function(propertyDesc){return new ReferenceHandler(propertyDesc,this.context)},ElementHandler.prototype.handler=function(type){return"Element"===type?new GenericElementHandler(this.model,type,this.context):new ElementHandler(this.model,type,this.context)},ElementHandler.prototype.handleChild=function(node){var propertyDesc,type,element,childHandler,nameNs=parseNameNs(node.local,node.prefix);
if(propertyDesc=this.getPropertyForElement(nameNs),element=this.element,type=propertyDesc.effectiveType||propertyDesc.type,Types.isSimple(propertyDesc.type))return this.valueHandler(propertyDesc,element);childHandler=propertyDesc.isReference?this.referenceHandler(propertyDesc).handleNode(node):this.handler(type).handleNode(node);var newElement=childHandler.element;return void 0!==newElement&&(propertyDesc.isMany?element.get(propertyDesc.name).push(newElement):element.set(propertyDesc.name,newElement),propertyDesc.isReference?(_.extend(newElement,{element:element}),this.context.addReference(newElement)):newElement.$parent=element),childHandler},GenericElementHandler.prototype=Object.create(BaseElementHandler.prototype),GenericElementHandler.prototype.createElement=function(node){var name=node.name,prefix=node.prefix,uri=node.ns[prefix],attributes=node.attributes;return this.model.createAny(name,uri,attributes)},GenericElementHandler.prototype.handleChild=function(node){var children,handler=new GenericElementHandler(this.model,"Element",this.context).handleNode(node),element=this.element,newElement=handler.element;return void 0!==newElement&&(children=element.$children=element.$children||[],children.push(newElement),newElement.$parent=element),handler},GenericElementHandler.prototype.handleText=function(text){this.body=this.body||""+text},GenericElementHandler.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)},XMLReader.prototype.fromXML=function(xml,rootHandler,done){function resolveReferences(){var i,r,elementsById=context.elementsById,references=context.references;for(i=0;r=references[i];i++){var element=r.element,reference=elementsById[r.id],property=element.$descriptor.propertiesByName[r.property];if(reference||context.addWarning({message:"unresolved reference <"+r.id+">",element:r.element,property:r.property,value:r.id}),property.isMany){var collection=element.get(property.name),idx=collection.indexOf(r);reference?collection[idx]=reference:collection.splice(idx,1)}else element.set(property.name,reference)}}function handleClose(){stack.pop().handleEnd()}function handleOpen(node){var handler=stack.peek();normalizeNamespaces(node,model);try{stack.push(handler.handleNode(node))}catch(e){var line=this.line,column=this.column;throw new Error("unparsable content <"+node.name+"> detected\n	line: "+line+"\n	column: "+column+"\n	nested error: "+e.message)}}function handleText(text){stack.peek().handleText(text)}var context=new Context(rootHandler),parser=sax.parser(!0,{xmlns:!0,trim:!0}),stack=new Stack,model=this.model;rootHandler.context=context,stack.push(rootHandler),parser.onopentag=handleOpen,parser.oncdata=parser.ontext=handleText,parser.onclosetag=handleClose,parser.onend=resolveReferences,_.defer(function(){var error;try{parser.write(xml).close()}catch(e){error=e}done(error,error?void 0:rootHandler.element,context)})},XMLReader.prototype.handler=function(name){return new ElementHandler(this.model,name)},module.exports=XMLReader,module.exports.ElementHandler=ElementHandler},{"./common":20,moddle:22,"tiny-stack":21}],19:[function(_dereq_,module){"use strict";function nsName(ns){return _.isString(ns)?ns:(ns.prefix?ns.prefix+":":"")+ns.localName}function getElementNs(ns,descriptor){return descriptor.isGeneric?descriptor.name:_.extend({localName:nameToAlias(descriptor.ns.localName,descriptor.$pkg)},ns)}function getPropertyNs(ns,descriptor){return _.extend({localName:descriptor.ns.localName},ns)}function getSerializableProperties(element){var descriptor=element.$descriptor;return _.filter(descriptor.properties,function(p){var name=p.name;if(!element.hasOwnProperty(name))return!1;var value=element[name];return value===p["default"]?!1:p.isMany?value.length:!0})}function escapeAttr(str){var escapeMap={"\n":"&#10;","\n\r":"&#10;",'"':"&quot;"};return str=_.isString(str)?str:""+str,str.replace(/(\n|\n\r|")/g,function(str){return escapeMap[str]})}function filterAttributes(props){return _.filter(props,function(p){return p.isAttr})}function filterContained(props){return _.filter(props,function(p){return!p.isAttr})}function ReferenceSerializer(parent,ns){this.ns=ns}function BodySerializer(){}function ValueSerializer(ns){this.ns=ns}function ElementSerializer(parent,ns){this.body=[],this.attrs=[],this.parent=parent,this.ns=ns}function TypeSerializer(parent,ns){ElementSerializer.call(this,parent,ns)}function SavingWriter(){this.value="",this.write=function(str){this.value+=str}}function FormatingWriter(out,format){var indent=[""];this.append=function(str){return out.write(str),this},this.appendNewLine=function(){return format&&out.write("\n"),this},this.appendIndent=function(){return format&&out.write(indent.join("  ")),this},this.indent=function(){return indent.push(""),this},this.unindent=function(){return indent.pop(),this}}function XMLWriter(options){function toXML(tree,writer){var internalWriter=writer||new SavingWriter,formatingWriter=new FormatingWriter(internalWriter,options.format);return options.preamble&&formatingWriter.append(XML_PREAMBLE),(new ElementSerializer).build(tree).serializeTo(formatingWriter),writer?void 0:internalWriter.value}return options=_.extend({format:!1,preamble:!0},options||{}),{toXML:toXML}}var _=window._,Types=_dereq_("moddle").types,common=_dereq_("./common"),parseNameNs=_dereq_("moddle").ns.parseName,nameToAlias=common.nameToAlias,XML_PREAMBLE='<?xml version="1.0" encoding="UTF-8"?>\n',CDATA_ESCAPE=/[<>"&]+/,DEFAULT_NS_MAP=common.DEFAULT_NS_MAP;ReferenceSerializer.prototype.build=function(element){return this.element=element,this},ReferenceSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+nsName(this.ns)+">"+this.element.id+"</"+nsName(this.ns)+">").appendNewLine()},BodySerializer.prototype.serializeValue=BodySerializer.prototype.serializeTo=function(writer){var escape=(this.value,this.escape);escape&&writer.append("<![CDATA["),writer.append(this.value),escape&&writer.append("]]>")},BodySerializer.prototype.build=function(prop,value){return this.value=value,"String"===prop.type&&CDATA_ESCAPE.test(value)&&(this.escape=!0),this},ValueSerializer.prototype=new BodySerializer,ValueSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+nsName(this.ns)+">"),this.serializeValue(writer),writer.append("</"+nsName(this.ns)+">").appendNewLine()},ElementSerializer.prototype.build=function(element){this.element=element;var otherAttrs=this.parseNsAttributes(element);if(this.ns||(this.ns=this.nsTagName(element.$descriptor)),element.$descriptor.isGeneric)this.parseGeneric(element);else{var properties=getSerializableProperties(element);this.parseAttributes(filterAttributes(properties)),this.parseContainments(filterContained(properties)),this.parseGenericAttributes(element,otherAttrs)}return this},ElementSerializer.prototype.nsTagName=function(descriptor){var effectiveNs=this.logNamespaceUsed(descriptor.ns);return getElementNs(effectiveNs,descriptor)},ElementSerializer.prototype.nsPropertyTagName=function(descriptor){var effectiveNs=this.logNamespaceUsed(descriptor.ns);return getPropertyNs(effectiveNs,descriptor)},ElementSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.ns.uri},ElementSerializer.prototype.nsAttributeName=function(element){var ns;_.isString(element)?ns=parseNameNs(element):element.ns&&(ns=element.ns);var effectiveNs=this.logNamespaceUsed(ns);return this.isLocalNs(effectiveNs)?{localName:ns.localName}:_.extend({localName:ns.localName},effectiveNs)},ElementSerializer.prototype.parseGeneric=function(element){var self=this,body=this.body,attrs=this.attrs;_.forEach(element,function(val,key){"$body"===key?body.push((new BodySerializer).build({type:"String"},val)):"$children"===key?_.forEach(val,function(child){body.push(new ElementSerializer(self).build(child))}):0!==key.indexOf("$")&&attrs.push({name:key,value:escapeAttr(val)})})},ElementSerializer.prototype.parseNsAttributes=function(element){var self=this,genericAttrs=element.$attrs,attributes=[];return _.forEach(genericAttrs,function(value,name){var nameNs=parseNameNs(name);"xmlns"===nameNs.prefix?self.logNamespace({prefix:nameNs.localName,uri:value}):nameNs.prefix||"xmlns"!==nameNs.localName?attributes.push({name:name,value:value}):self.logNamespace({uri:value})}),attributes},ElementSerializer.prototype.parseGenericAttributes=function(element,attributes){var self=this;_.forEach(attributes,function(attr){try{self.addAttribute(self.nsAttributeName(attr.name),attr.value)}catch(e){console.warn("[writer] missing namespace information for ",attr.name,"=",attr.value,"on",element,e)}})},ElementSerializer.prototype.parseContainments=function(properties){{var self=this,body=this.body,element=this.element;element.$descriptor}_.forEach(properties,function(p){var value=element.get(p.name),isReference=p.isReference,isMany=p.isMany,ns=self.nsPropertyTagName(p);if(isMany||(value=[value]),p.isBody)body.push((new BodySerializer).build(p,value[0]));else if(Types.isSimple(p.type))_.forEach(value,function(v){body.push(new ValueSerializer(ns).build(p,v))});else if(isReference)_.forEach(value,function(v){body.push(new ReferenceSerializer(self,ns).build(v))});else{var asType="xsi:type"===p.serialize;_.forEach(value,function(v){var serializer;serializer=asType?new TypeSerializer(self,ns):new ElementSerializer(self),body.push(serializer.build(v))})}})},ElementSerializer.prototype.getNamespaces=function(){return this.parent?this.namespaces=this.parent.getNamespaces():this.namespaces||(this.namespaces={prefixMap:{},uriMap:{},used:{}}),this.namespaces},ElementSerializer.prototype.logNamespace=function(ns){var namespaces=this.getNamespaces(),existing=namespaces.uriMap[ns.uri];return existing||(namespaces.uriMap[ns.uri]=ns),namespaces.prefixMap[ns.prefix]=ns.uri,ns},ElementSerializer.prototype.logNamespaceUsed=function(ns){var element=this.element,model=element.$model,namespaces=this.getNamespaces(),prefix=ns.prefix,uri=ns.uri||DEFAULT_NS_MAP[prefix]||namespaces.prefixMap[prefix]||(model?(model.getPackage(prefix)||{}).uri:null);if(!uri)throw new Error("no namespace uri given for prefix <"+ns.prefix+">");return ns=namespaces.uriMap[uri],ns||(ns=this.logNamespace({prefix:prefix,uri:uri})),namespaces.used[ns.uri]||(namespaces.used[ns.uri]=ns),ns},ElementSerializer.prototype.parseAttributes=function(properties){var self=this,element=this.element;_.forEach(properties,function(p){self.logNamespaceUsed(p.ns);var value=element.get(p.name);p.isReference&&(value=value.id),self.addAttribute(self.nsAttributeName(p),value)})},ElementSerializer.prototype.addAttribute=function(name,value){var attrs=this.attrs;_.isString(value)&&(value=escapeAttr(value)),attrs.push({name:name,value:value})},ElementSerializer.prototype.serializeAttributes=function(writer){function collectNsAttrs(){return _.collect(namespaces.used,function(ns){var name="xmlns"+(ns.prefix?":"+ns.prefix:"");return{name:name,value:ns.uri}})}var attrs=(this.element,this.attrs),root=!this.parent,namespaces=this.namespaces;root&&(attrs=collectNsAttrs().concat(attrs)),_.forEach(attrs,function(a){writer.append(" ").append(nsName(a.name)).append('="').append(a.value).append('"')})},ElementSerializer.prototype.serializeTo=function(writer){var hasBody=this.body.length;writer.appendIndent().append("<"+nsName(this.ns)),this.serializeAttributes(writer),writer.append(hasBody?">":" />").appendNewLine(),writer.indent(),_.forEach(this.body,function(b){b.serializeTo(writer)}),writer.unindent(),hasBody&&writer.appendIndent().append("</"+nsName(this.ns)+">").appendNewLine()},TypeSerializer.prototype=new ElementSerializer,TypeSerializer.prototype.build=function(element){return this.element=element,this.typeNs=this.nsTagName(element.$descriptor),ElementSerializer.prototype.build.call(this,element)},TypeSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.typeNs.uri},module.exports=XMLWriter},{"./common":20,moddle:22}],20:[function(_dereq_,module){"use strict";function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1)}function lower(string){return string.charAt(0).toLowerCase()+string.slice(1)}function hasLowerCaseAlias(pkg){return pkg.xml&&"lowerCase"===pkg.xml.alias}module.exports.aliasToName=function(alias,pkg){return hasLowerCaseAlias(pkg)?capitalize(alias):alias},module.exports.nameToAlias=function(name,pkg){return hasLowerCaseAlias(pkg)?lower(name):name},module.exports.DEFAULT_NS_MAP={xsi:"http://www.w3.org/2001/XMLSchema-instance"}},{}],21:[function(_dereq_,module,exports){!function(global){"use strict";function TinyStack(){this.data=[null],this.top=0}function factory(){return new TinyStack}TinyStack.prototype.clear=function(){return this.data=[null],this.top=0,this},TinyStack.prototype.length=function(){return this.top},TinyStack.prototype.peek=function(){return this.data[this.top]},TinyStack.prototype.pop=function(){return this.top>0?(this.top--,this.data.pop()):void 0},TinyStack.prototype.push=function(arg){return this.data[++this.top]=arg,this},"undefined"!=typeof exports?module.exports=factory:"function"==typeof define?define(function(){return factory}):global.stack=factory}(this)},{}],22:[function(_dereq_,module){"use strict";module.exports=_dereq_("./lib/moddle"),module.exports.types=_dereq_("./lib/types"),module.exports.ns=_dereq_("./lib/ns")},{"./lib/moddle":26,"./lib/ns":27,"./lib/types":30}],23:[function(_dereq_,module){"use strict";function Base(){}Base.prototype.get=function(name){return this.$model.properties.get(this,name)},Base.prototype.set=function(name,value){this.$model.properties.set(this,name,value)},module.exports=Base},{}],24:[function(_dereq_,module){"use strict";function DescriptorBuilder(nameNs){this.ns=nameNs,this.name=nameNs.name,this.allTypes=[],this.properties=[],this.propertiesByName={}}var _=window._,parseNameNs=_dereq_("./ns").parseName;module.exports=DescriptorBuilder,DescriptorBuilder.prototype.build=function(){return _.pick(this,["ns","name","allTypes","properties","propertiesByName","bodyProperty"])},DescriptorBuilder.prototype.addProperty=function(p,idx){this.addNamedProperty(p,!0);var properties=this.properties;void 0!==idx?properties.splice(idx,0,p):properties.push(p)},DescriptorBuilder.prototype.replaceProperty=function(oldProperty,newProperty){var oldNameNs=oldProperty.ns,props=this.properties,propertiesByName=this.propertiesByName;if(oldProperty.isBody){if(!newProperty.isBody)throw new Error("property <"+newProperty.ns.name+"> must be body property to refine <"+oldProperty.ns.name+">");this.setBodyProperty(newProperty,!1)}this.addNamedProperty(newProperty,!0);var idx=props.indexOf(oldProperty);if(-1===idx)throw new Error("property <"+oldNameNs.name+"> not found in property list");props[idx]=newProperty,propertiesByName[oldNameNs.name]=propertiesByName[oldNameNs.localName]=newProperty},DescriptorBuilder.prototype.redefineProperty=function(p){var nsPrefix=p.ns.prefix,parts=p.redefines.split("#"),name=parseNameNs(parts[0],nsPrefix),attrName=parseNameNs(parts[1],name.prefix).name,redefinedProperty=this.propertiesByName[attrName];if(!redefinedProperty)throw new Error("refined property <"+attrName+"> not found");this.replaceProperty(redefinedProperty,p),delete p.redefines},DescriptorBuilder.prototype.addNamedProperty=function(p,validate){var ns=p.ns,propsByName=this.propertiesByName;validate&&(this.assertNotDefined(p,ns.name),this.assertNotDefined(p,ns.localName)),propsByName[ns.name]=propsByName[ns.localName]=p},DescriptorBuilder.prototype.removeNamedProperty=function(p){var ns=p.ns,propsByName=this.propertiesByName;delete propsByName[ns.name],delete propsByName[ns.localName]},DescriptorBuilder.prototype.setBodyProperty=function(p,validate){if(validate&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+p.ns.name+">)");this.bodyProperty=p},DescriptorBuilder.prototype.addIdProperty=function(name){var nameNs=parseNameNs(name,this.ns.prefix),p={name:nameNs.localName,type:"String",isAttr:!0,ns:nameNs};this.addProperty(p,0)},DescriptorBuilder.prototype.assertNotDefined=function(p){var propertyName=p.name,definedProperty=this.propertiesByName[propertyName];if(definedProperty)throw new Error("property <"+propertyName+"> already defined; override of <"+definedProperty.definedBy.ns.name+"#"+definedProperty.ns.name+"> by <"+p.definedBy.ns.name+"#"+p.ns.name+"> not allowed without redefines")},DescriptorBuilder.prototype.hasProperty=function(name){return this.propertiesByName[name]},DescriptorBuilder.prototype.addTrait=function(t){var allTypes=this.allTypes;-1===allTypes.indexOf(t)&&(_.forEach(t.properties,function(p){p=_.extend({},p,{name:p.ns.localName}),Object.defineProperty(p,"definedBy",{value:t}),p.redefines?this.redefineProperty(p):(p.isBody&&this.setBodyProperty(p),this.addProperty(p))},this),allTypes.push(t))}},{"./ns":27}],25:[function(_dereq_,module){"use strict";function Factory(model,properties){this.model=model,this.properties=properties}var _=window._,Base=_dereq_("./base");module.exports=Factory,Factory.prototype.createType=function(descriptor){function ModdleElement(attrs){props.define(this,"$type",{value:name,enumerable:!0}),props.define(this,"$attrs",{value:{}}),props.define(this,"$parent",{writable:!0}),_.forEach(attrs,function(val,key){this.set(key,val)},this)}var model=this.model,props=this.properties,prototype=Object.create(Base.prototype);_.forEach(descriptor.properties,function(p){p.isMany||void 0===p["default"]||(prototype[p.name]=p["default"])}),props.defineModel(prototype,model),props.defineDescriptor(prototype,descriptor);var name=descriptor.ns.name;return ModdleElement.prototype=prototype,ModdleElement.hasType=prototype.$instanceOf=this.model.hasType,props.defineModel(ModdleElement,model),props.defineDescriptor(ModdleElement,descriptor),ModdleElement}},{"./base":23}],26:[function(_dereq_,module){"use strict";function Moddle(packages,options){options=options||{},this.properties=new Properties(this),this.factory=new Factory(this,this.properties),this.registry=new Registry(packages,this.properties,options),this.typeCache={}}var _=window._,Factory=(_dereq_("./types"),_dereq_("./factory")),Registry=_dereq_("./registry"),Properties=_dereq_("./properties"),parseNameNs=_dereq_("./ns").parseName;module.exports=Moddle,Moddle.prototype.create=function(descriptor,attrs){var Type=this.getType(descriptor);if(!Type)throw new Error("unknown type <"+descriptor+">");return new Type(attrs)},Moddle.prototype.getType=function(descriptor){var cache=this.typeCache,name=_.isString(descriptor)?descriptor:descriptor.ns.name,type=cache[name];return type||(descriptor=this.registry.getEffectiveDescriptor(name),type=cache[descriptor.name]=this.factory.createType(descriptor)),type},Moddle.prototype.createAny=function(name,nsUri,properties){var nameNs=parseNameNs(name),element={$type:name},descriptor={name:name,isGeneric:!0,ns:{prefix:nameNs.prefix,localName:nameNs.localName,uri:nsUri}};return this.properties.defineDescriptor(element,descriptor),this.properties.defineModel(element,this),this.properties.define(element,"$parent",{enumerable:!1,writable:!0}),_.forEach(properties,function(a,key){_.isObject(a)&&void 0!==a.value?element[a.name]=a.value:element[key]=a}),element},Moddle.prototype.getPackage=function(uriOrPrefix){return this.registry.getPackage(uriOrPrefix)},Moddle.prototype.getPackages=function(){return this.registry.getPackages()},Moddle.prototype.getElementDescriptor=function(element){return element.$descriptor},Moddle.prototype.hasType=function(element,type){void 0===type&&(type=element,element=this);var descriptor=element.$model.getElementDescriptor(element);return!!_.find(descriptor.allTypes,function(t){return t.name===type})},Moddle.prototype.getPropertyDescriptor=function(element,property){return this.getElementDescriptor(element).propertiesByName[property]}},{"./factory":25,"./ns":27,"./properties":28,"./registry":29,"./types":30}],27:[function(_dereq_,module){"use strict";module.exports.parseName=function(name,defaultPrefix){var localName,prefix,parts=name.split(/:/);if(1===parts.length)localName=name,prefix=defaultPrefix;else{if(2!==parts.length)throw new Error("expected <prefix:localName> or <localName>, got "+name);localName=parts[1],prefix=parts[0]}return name=(prefix?prefix+":":"")+localName,{name:name,prefix:prefix,localName:localName}}},{}],28:[function(_dereq_,module){"use strict";function Properties(model){this.model=model}module.exports=Properties,Properties.prototype.set=function(target,name,value){var property=this.model.getPropertyDescriptor(target,name);property?Object.defineProperty(target,property.name,{enumerable:!property.isReference,writable:!0,value:value}):target.$attrs[name]=value},Properties.prototype.get=function(target,name){var property=this.model.getPropertyDescriptor(target,name);if(!property)return target.$attrs[name];var propertyName=property.name;return!target[propertyName]&&property.isMany&&Object.defineProperty(target,propertyName,{enumerable:!property.isReference,writable:!0,value:[]}),target[propertyName]},Properties.prototype.define=function(target,name,options){Object.defineProperty(target,name,options)},Properties.prototype.defineDescriptor=function(target,descriptor){this.define(target,"$descriptor",{value:descriptor})},Properties.prototype.defineModel=function(target,model){this.define(target,"$model",{value:model})}},{}],29:[function(_dereq_,module){"use strict";function Registry(packages,properties,options){this.options=_.extend({generateId:"id"},options||{}),this.packageMap={},this.typeMap={},this.packages=[],this.properties=properties,_.forEach(packages,this.registerPackage,this)}var _=window._,Types=_dereq_("./types"),DescriptorBuilder=_dereq_("./descriptor-builder"),parseNameNs=_dereq_("./ns").parseName;module.exports=Registry,Registry.prototype.getPackage=function(uriOrPrefix){return this.packageMap[uriOrPrefix]},Registry.prototype.getPackages=function(){return this.packages},Registry.prototype.registerPackage=function(pkg){_.forEach(pkg.types,function(descriptor){this.registerType(descriptor,pkg)},this),this.packageMap[pkg.uri]=this.packageMap[pkg.prefix]=pkg,this.packages.push(pkg)},Registry.prototype.registerType=function(type,pkg){var ns=parseNameNs(type.name,pkg.prefix),name=ns.name,propertiesByName={};_.forEach(type.properties,function(p){var propertyNs=parseNameNs(p.name,ns.prefix),propertyName=propertyNs.name;Types.isBuiltIn(p.type)||(p.type=parseNameNs(p.type,propertyNs.prefix).name),_.extend(p,{ns:propertyNs,name:propertyName}),propertiesByName[propertyName]=p}),_.extend(type,{ns:ns,name:name,propertiesByName:propertiesByName}),this.definePackage(type,pkg),this.typeMap[name]=type},Registry.prototype.mapTypes=function(nsName,iterator){var type=this.typeMap[nsName.name];if(!type)throw new Error("unknown type <"+nsName.name+">");_.forEach(type.superClass,function(cls){var parentNs=parseNameNs(cls,nsName.prefix);this.mapTypes(parentNs,iterator)},this),iterator(type)},Registry.prototype.getEffectiveDescriptor=function(name){var nsName=(this.options,parseNameNs(name)),builder=new DescriptorBuilder(nsName);this.mapTypes(nsName,function(type){builder.addTrait(type)});var id=this.options.generateId;id&&!builder.hasProperty(id)&&builder.addIdProperty(id);var descriptor=builder.build();return this.definePackage(descriptor,descriptor.allTypes[descriptor.allTypes.length-1].$pkg),descriptor},Registry.prototype.definePackage=function(target,pkg){this.properties.define(target,"$pkg",{value:pkg})}},{"./descriptor-builder":24,"./ns":27,"./types":30}],30:[function(_dereq_,module){"use strict";var BUILTINS={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},TYPE_CONVERTERS={String:function(s){return s},Boolean:function(s){return"true"===s},Integer:function(s){return parseInt(s,10)},Real:function(s){return parseFloat(s,10)}};module.exports.coerceType=function(type,value){var converter=TYPE_CONVERTERS[type];return converter?converter(value):value},module.exports.isBuiltIn=function(type){return!!BUILTINS[type]},module.exports.isSimple=function(type){return!!TYPE_CONVERTERS[type]}},{}],31:[function(_dereq_,module){module.exports={name:"BPMN20",uri:"http://www.omg.org/spec/BPMN/20100524/MODEL",associations:[],types:[{name:"Interface",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"operations",type:"Operation",association:"A_operations_interface",isMany:!0},{name:"implementationRef",type:"String",isAttr:!0}]},{name:"Operation",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"inMessageRef",type:"Message",association:"A_inMessageRef_operation",isAttr:!0,isReference:!0},{name:"outMessageRef",type:"Message",association:"A_outMessageRef_operation",isAttr:!0,isReference:!0},{name:"errorRefs",type:"Error",association:"A_errorRefs_operation",isMany:!0,isReference:!0},{name:"implementationRef",type:"String",isAttr:!0}]},{name:"EndPoint",superClass:["RootElement"]},{name:"Auditing",superClass:["BaseElement"]},{name:"GlobalTask",superClass:["CallableElement"],properties:[{name:"resources",type:"ResourceRole",association:"A_resources_globalTask",isMany:!0}]},{name:"Monitoring",superClass:["BaseElement"]},{name:"Performer",superClass:["ResourceRole"]},{name:"Process",superClass:["FlowElementsContainer","CallableElement"],properties:[{name:"processType",type:"ProcessType",isAttr:!0},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"auditing",type:"Auditing",association:"A_auditing_process"},{name:"monitoring",type:"Monitoring",association:"A_monitoring_process"},{name:"properties",type:"Property",association:"A_properties_process",isMany:!0},{name:"supports",type:"Process",association:"A_supports_process",isMany:!0,isReference:!0},{name:"definitionalCollaborationRef",type:"Collaboration",association:"A_definitionalCollaborationRef_process",isAttr:!0,isReference:!0},{name:"isExecutable",isAttr:!0,type:"Boolean"},{name:"resources",type:"ResourceRole",association:"A_resources_process",isMany:!0},{name:"artifacts",type:"Artifact",association:"A_artifacts_process",isMany:!0},{name:"correlationSubscriptions",type:"CorrelationSubscription",association:"A_correlationSubscriptions_process",isMany:!0}]},{name:"LaneSet",superClass:["BaseElement"],properties:[{name:"lanes",type:"Lane",association:"A_lanes_laneSet",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Lane",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"childLaneSet",type:"LaneSet",association:"A_childLaneSet_parentLane"},{name:"partitionElementRef",type:"BaseElement",association:"A_partitionElementRef_lane",isAttr:!0,isReference:!0},{name:"flowNodeRef",type:"FlowNode",association:"A_flowNodeRefs_lanes",isMany:!0,isReference:!0},{name:"partitionElement",type:"BaseElement",association:"A_partitionElement_lane"}]},{name:"GlobalManualTask",superClass:["GlobalTask"]},{name:"ManualTask",superClass:["Task"]},{name:"UserTask",superClass:["Task"],properties:[{name:"renderings",type:"Rendering",association:"A_renderings_usertask",isMany:!0},{name:"implementation",isAttr:!0,type:"String"}]},{name:"Rendering",superClass:["BaseElement"]},{name:"HumanPerformer",superClass:["Performer"]},{name:"PotentialOwner",superClass:["HumanPerformer"]},{name:"GlobalUserTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"renderings",type:"Rendering",association:"A_renderings_globalUserTask",isMany:!0}]},{name:"Gateway",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"gatewayDirection",type:"GatewayDirection","default":"Unspecified",isAttr:!0}]},{name:"EventBasedGateway",superClass:["Gateway"],properties:[{name:"instantiate","default":!1,isAttr:!0,type:"Boolean"},{name:"eventGatewayType",type:"EventBasedGatewayType",isAttr:!0,"default":"Exclusive"}]},{name:"ComplexGateway",superClass:["Gateway"],properties:[{name:"activationCondition",type:"Expression",association:"A_activationCondition_complexGateway"},{name:"default",type:"SequenceFlow",association:"A_default_complexGateway",isAttr:!0,isReference:!0}]},{name:"ExclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",association:"A_default_exclusiveGateway",isAttr:!0,isReference:!0}]},{name:"InclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",association:"A_default_inclusiveGateway",isAttr:!0,isReference:!0}]},{name:"ParallelGateway",superClass:["Gateway"]},{name:"RootElement",isAbstract:!0,superClass:["BaseElement"]},{name:"Relationship",superClass:["BaseElement"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"direction",type:"RelationshipDirection",isAttr:!0},{name:"sources",association:"A_sources_relationship",isMany:!0,isReference:!0,type:"Element"},{name:"targets",association:"A_targets_relationship",isMany:!0,isReference:!0,type:"Element"}]},{name:"BaseElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,type:"String"},{name:"extensionDefinitions",type:"ExtensionDefinition",association:"A_extensionDefinitions_baseElement",isMany:!0,isReference:!0},{name:"extensionElements",type:"ExtensionElements",association:"A_extensionElements_baseElement"},{name:"documentation",type:"Documentation",association:"A_documentation_baseElement",isMany:!0}]},{name:"Extension",properties:[{name:"mustUnderstand","default":!1,isAttr:!0,type:"Boolean"},{name:"definition",type:"ExtensionDefinition",association:"A_definition_extension"}]},{name:"ExtensionDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"extensionAttributeDefinitions",type:"ExtensionAttributeDefinition",association:"A_extensionAttributeDefinitions_extensionDefinition",isMany:!0}]},{name:"ExtensionAttributeDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"},{name:"isReference","default":!1,isAttr:!0,type:"Boolean"},{name:"extensionDefinition",type:"ExtensionDefinition",association:"A_extensionAttributeDefinitions_extensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionElements",properties:[{name:"valueRef",association:"A_valueRef_extensionElements",isAttr:!0,isReference:!0,type:"Element"},{name:"values",association:"A_value_extensionElements",type:"Element",isMany:!0},{name:"extensionAttributeDefinition",type:"ExtensionAttributeDefinition",association:"A_extensionAttributeDefinition_extensionElements",isAttr:!0,isReference:!0}]},{name:"Documentation",superClass:["BaseElement"],properties:[{name:"text",type:"String",isBody:!0},{name:"textFormat","default":"text/plain",isAttr:!0,type:"String"}]},{name:"Event",isAbstract:!0,superClass:["FlowNode","InteractionNode"],properties:[{name:"properties",type:"Property",association:"A_properties_event",isMany:!0}]},{name:"IntermediateCatchEvent",superClass:["CatchEvent"]},{name:"IntermediateThrowEvent",superClass:["ThrowEvent"]},{name:"EndEvent",superClass:["ThrowEvent"]},{name:"StartEvent",superClass:["CatchEvent"],properties:[{name:"isInterrupting","default":!0,isAttr:!0,type:"Boolean"}]},{name:"ThrowEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"inputSet",type:"InputSet",association:"A_inputSet_throwEvent"},{name:"eventDefinitionRefs",type:"EventDefinition",association:"A_eventDefinitionRefs_throwEvent",isMany:!0,isReference:!0},{name:"dataInputAssociation",type:"DataInputAssociation",association:"A_dataInputAssociation_throwEvent",isMany:!0},{name:"dataInputs",type:"DataInput",association:"A_dataInputs_throwEvent",isMany:!0},{name:"eventDefinitions",type:"EventDefinition",association:"A_eventDefinitions_throwEvent",isMany:!0}]},{name:"CatchEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"parallelMultiple",isAttr:!0,type:"Boolean","default":!1},{name:"outputSet",type:"OutputSet",association:"A_outputSet_catchEvent"},{name:"eventDefinitionRefs",type:"EventDefinition",association:"A_eventDefinitionRefs_catchEvent",isMany:!0,isReference:!0},{name:"dataOutputAssociation",type:"DataOutputAssociation",association:"A_dataOutputAssociation_catchEvent",isMany:!0},{name:"dataOutputs",type:"DataOutput",association:"A_dataOutputs_catchEvent",isMany:!0},{name:"eventDefinitions",type:"EventDefinition",association:"A_eventDefinitions_catchEvent",isMany:!0}]},{name:"BoundaryEvent",superClass:["CatchEvent"],properties:[{name:"cancelActivity","default":!0,isAttr:!0,type:"Boolean"},{name:"attachedToRef",type:"Activity",association:"A_boundaryEventRefs_attachedToRef",isAttr:!0,isReference:!0}]},{name:"EventDefinition",isAbstract:!0,superClass:["RootElement"]},{name:"CancelEventDefinition",superClass:["EventDefinition"]},{name:"ErrorEventDefinition",superClass:["EventDefinition"],properties:[{name:"errorRef",type:"Error",association:"A_errorRef_errorEventDefinition",isAttr:!0,isReference:!0}]},{name:"TerminateEventDefinition",superClass:["EventDefinition"]},{name:"EscalationEventDefinition",superClass:["EventDefinition"],properties:[{name:"escalationRef",type:"Escalation",association:"A_escalationRef_escalationEventDefinition",isAttr:!0,isReference:!0}]},{name:"Escalation",properties:[{name:"structureRef",type:"ItemDefinition",association:"A_structureRef_escalation",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"escalationCode",isAttr:!0,type:"String"}],superClass:["RootElement"]},{name:"CompensateEventDefinition",superClass:["EventDefinition"],properties:[{name:"waitForCompletion",isAttr:!0,type:"Boolean"},{name:"activityRef",type:"Activity",association:"A_activityRef_compensateEventDefinition",isAttr:!0,isReference:!0}]},{name:"TimerEventDefinition",superClass:["EventDefinition"],properties:[{name:"timeDate",type:"Expression",association:"A_timeDate_timerEventDefinition"},{name:"timeCycle",type:"Expression",association:"A_timeCycle_timerEventDefinition"},{name:"timeDuration",type:"Expression",association:"A_timeDuration_timerEventDefinition"}]},{name:"LinkEventDefinition",superClass:["EventDefinition"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"target",type:"LinkEventDefinition",association:"A_target_source",isAttr:!0,isReference:!0},{name:"source",type:"LinkEventDefinition",association:"A_target_source",isMany:!0,isReference:!0}]},{name:"MessageEventDefinition",superClass:["EventDefinition"],properties:[{name:"messageRef",type:"Message",association:"A_messageRef_messageEventDefinition",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",association:"A_operationRef_messageEventDefinition",isAttr:!0,isReference:!0}]},{name:"ConditionalEventDefinition",superClass:["EventDefinition"],properties:[{name:"condition",type:"Expression",association:"A_condition_conditionalEventDefinition",serialize:"xsi:type"}]},{name:"SignalEventDefinition",superClass:["EventDefinition"],properties:[{name:"signalRef",type:"Signal",association:"A_signalRef_signalEventDefinition",isAttr:!0,isReference:!0}]},{name:"Signal",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",association:"A_structureRef_signal",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ImplicitThrowEvent",superClass:["ThrowEvent"]},{name:"DataState",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"ItemAwareElement",superClass:["BaseElement"],properties:[{name:"itemSubjectRef",type:"ItemDefinition",association:"A_itemSubjectRef_itemAwareElement",isAttr:!0,isReference:!0},{name:"dataState",type:"DataState",association:"A_dataState_itemAwareElement"}]},{name:"DataAssociation",superClass:["BaseElement"],properties:[{name:"transformation",type:"FormalExpression",association:"A_transformation_dataAssociation"},{name:"assignment",type:"Assignment",association:"A_assignment_dataAssociation",isMany:!0},{name:"sourceRef",type:"ItemAwareElement",association:"A_sourceRef_dataAssociation",isMany:!0,isReference:!0},{name:"targetRef",type:"ItemAwareElement",association:"A_targetRef_dataAssociation",isReference:!0}]},{name:"DataInput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection","default":!1,isAttr:!0,type:"Boolean"},{name:"inputSetRefs",type:"InputSet",association:"A_dataInputRefs_inputSetRefs",isVirtual:!0,isMany:!0,isReference:!0},{name:"inputSetWithOptional",type:"InputSet",association:"A_optionalInputRefs_inputSetWithOptional",isVirtual:!0,isMany:!0,isReference:!0},{name:"inputSetWithWhileExecuting",type:"InputSet",association:"A_whileExecutingInputRefs_inputSetWithWhileExecuting",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"DataOutput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection","default":!1,isAttr:!0,type:"Boolean"},{name:"outputSetRefs",type:"OutputSet",association:"A_dataOutputRefs_outputSetRefs",isVirtual:!0,isMany:!0,isReference:!0},{name:"outputSetWithOptional",type:"OutputSet",association:"A_outputSetWithOptional_optionalOutputRefs",isVirtual:!0,isMany:!0,isReference:!0},{name:"outputSetWithWhileExecuting",type:"OutputSet",association:"A_outputSetWithWhileExecuting_whileExecutingOutputRefs",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"InputSet",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"dataInputRefs",type:"DataInput",association:"A_dataInputRefs_inputSetRefs",isMany:!0,isReference:!0},{name:"optionalInputRefs",type:"DataInput",association:"A_optionalInputRefs_inputSetWithOptional",isMany:!0,isReference:!0},{name:"whileExecutingInputRefs",type:"DataInput",association:"A_whileExecutingInputRefs_inputSetWithWhileExecuting",isMany:!0,isReference:!0},{name:"outputSetRefs",type:"OutputSet",association:"A_inputSetRefs_outputSetRefs",isMany:!0,isReference:!0}]},{name:"OutputSet",superClass:["BaseElement"],properties:[{name:"dataOutputRefs",type:"DataOutput",association:"A_dataOutputRefs_outputSetRefs",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"inputSetRefs",type:"InputSet",association:"A_inputSetRefs_outputSetRefs",isMany:!0,isReference:!0},{name:"optionalOutputRefs",type:"DataOutput",association:"A_outputSetWithOptional_optionalOutputRefs",isMany:!0,isReference:!0},{name:"whileExecutingOutputRefs",type:"DataOutput",association:"A_outputSetWithWhileExecuting_whileExecutingOutputRefs",isMany:!0,isReference:!0}]},{name:"Property",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"DataInputAssociation",superClass:["DataAssociation"]},{name:"DataOutputAssociation",superClass:["DataAssociation"]},{name:"InputOutputSpecification",superClass:["BaseElement"],properties:[{name:"inputSets",type:"InputSet",association:"A_inputSets_inputOutputSpecification",isMany:!0},{name:"outputSets",type:"OutputSet",association:"A_outputSets_inputOutputSpecification",isMany:!0},{name:"dataInputs",type:"DataInput",association:"A_dataInputs_inputOutputSpecification",isMany:!0},{name:"dataOutputs",type:"DataOutput",association:"A_dataOutputs_inputOutputSpecification",isMany:!0}]},{name:"DataObject",superClass:["FlowElement","ItemAwareElement"],properties:[{name:"isCollection","default":!1,isAttr:!0,type:"Boolean"}]},{name:"InputOutputBinding",properties:[{name:"inputDataRef",type:"InputSet",association:"A_inputDataRef_inputOutputBinding",isAttr:!0,isReference:!0},{name:"outputDataRef",type:"OutputSet",association:"A_outputDataRef_inputOutputBinding",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",association:"A_operationRef_ioBinding",isAttr:!0,isReference:!0}]},{name:"Assignment",superClass:["BaseElement"],properties:[{name:"from",type:"Expression",association:"A_from_assignment"},{name:"to",type:"Expression",association:"A_to_assignment"}]},{name:"DataStore",superClass:["RootElement","ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"capacity",isAttr:!0,type:"Integer"},{name:"isUnlimited","default":!0,isAttr:!0,type:"Boolean"}]},{name:"DataStoreReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataStoreRef",type:"DataStore",association:"A_dataStoreRef_dataStoreReference",isAttr:!0,isReference:!0}]},{name:"DataObjectReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataObjectRef",type:"DataObject",association:"A_dataObjectRef_dataObject",isAttr:!0,isReference:!0}]},{name:"ConversationLink",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"InteractionNode",association:"A_sourceRef_outgoingConversationLinks",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",association:"A_targetRef_incomingConversationLinks",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ConversationAssociation",superClass:["BaseElement"],properties:[{name:"innerConversationNodeRef",type:"ConversationNode",association:"A_innerConversationNodeRef_conversationAssociation",isAttr:!0,isReference:!0},{name:"outerConversationNodeRef",type:"ConversationNode",association:"A_outerConversationNodeRef_conversationAssociation",isAttr:!0,isReference:!0}]},{name:"CallConversation",superClass:["ConversationNode"],properties:[{name:"calledCollaborationRef",type:"Collaboration",association:"A_calledCollaborationRef_callConversation",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",association:"A_participantAssociations_callConversation",isMany:!0}]},{name:"Conversation",superClass:["ConversationNode"]},{name:"SubConversation",superClass:["ConversationNode"],properties:[{name:"conversationNodes",type:"ConversationNode",association:"A_conversationNodes_subConversation",isMany:!0}]},{name:"ConversationNode",isAbstract:!0,superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRefs",type:"Participant",association:"A_participantRefs_conversationNode",isMany:!0,isReference:!0},{name:"messageFlowRefs",type:"MessageFlow",association:"A_messageFlowRefs_communication",isMany:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",association:"A_correlationKeys_conversationNode",isMany:!0}]},{name:"GlobalConversation",superClass:["Collaboration"]},{name:"PartnerEntity",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",association:"A_partnerEntityRef_participantRef",isMany:!0,isReference:!0}]},{name:"PartnerRole",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",association:"A_partnerRoleRef_participantRef",isMany:!0,isReference:!0}]},{name:"CorrelationProperty",superClass:["RootElement"],properties:[{name:"correlationPropertyRetrievalExpression",type:"CorrelationPropertyRetrievalExpression",association:"A_correlationPropertyRetrievalExpression_correlationproperty",isMany:!0},{name:"name",isAttr:!0,type:"String"},{name:"type",type:"ItemDefinition",association:"A_type_correlationProperty",isAttr:!0,isReference:!0}]},{name:"Error",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",association:"A_structureRef_error",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"errorCode",isAttr:!0,type:"String"}]},{name:"CorrelationKey",superClass:["BaseElement"],properties:[{name:"correlationPropertyRef",type:"CorrelationProperty",association:"A_correlationPropertyRef_correlationKey",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Expression",superClass:["BaseElement"]},{name:"FormalExpression",superClass:["Expression"],properties:[{name:"language",isAttr:!0,type:"String"},{name:"body",type:"Element"},{name:"evaluatesToTypeRef",type:"ItemDefinition",association:"A_evaluatesToTypeRef_formalExpression",isAttr:!0,isReference:!0}]},{name:"Message",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"itemRef",type:"ItemDefinition",association:"A_itemRef_message",isAttr:!0,isReference:!0}]},{name:"ItemDefinition",superClass:["RootElement"],properties:[{name:"itemKind",type:"ItemKind",isAttr:!0},{name:"structureRef",type:"String",isAttr:!0},{name:"isCollection","default":!1,isAttr:!0,type:"Boolean"},{name:"import",type:"Import",association:"A_import_itemDefinition",isAttr:!0,isReference:!0}]},{name:"FlowElement",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"auditing",type:"Auditing",association:"A_auditing_flowElement"},{name:"monitoring",type:"Monitoring",association:"A_monitoring_flowElement"},{name:"categoryValueRef",type:"CategoryValue",association:"A_categorizedFlowElements_categoryValueRef",isMany:!0,isReference:!0}]},{name:"SequenceFlow",superClass:["FlowElement"],properties:[{name:"isImmediate",isAttr:!0,type:"Boolean"},{name:"conditionExpression",type:"Expression",association:"A_conditionExpression_sequenceFlow"},{name:"sourceRef",type:"FlowNode",association:"A_sourceRef_outgoing_flow",isAttr:!0,isReference:!0},{name:"targetRef",type:"FlowNode",association:"A_targetRef_incoming_flow",isAttr:!0,isReference:!0}]},{name:"FlowElementsContainer",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"laneSets",type:"LaneSet",association:"A_laneSets_flowElementsContainer",isMany:!0},{name:"flowElements",type:"FlowElement",association:"A_flowElements_container",isMany:!0}]},{name:"CallableElement",isAbstract:!0,superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"ioSpecification",type:"InputOutputSpecification",association:"A_ioSpecification_callableElement"},{name:"supportedInterfaceRefs",type:"Interface",association:"A_supportedInterfaceRefs_callableElements",isMany:!0,isReference:!0},{name:"ioBinding",type:"InputOutputBinding",association:"A_ioBinding_callableElement",isMany:!0}]},{name:"FlowNode",isAbstract:!0,superClass:["FlowElement"],properties:[{name:"incoming",type:"SequenceFlow",association:"A_targetRef_incoming_flow",isMany:!0,isReference:!0},{name:"outgoing",type:"SequenceFlow",association:"A_sourceRef_outgoing_flow",isMany:!0,isReference:!0},{name:"lanes",type:"Lane",association:"A_flowNodeRefs_lanes",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"CorrelationPropertyRetrievalExpression",superClass:["BaseElement"],properties:[{name:"messagePath",type:"FormalExpression",association:"A_messagePath_correlationset"},{name:"messageRef",type:"Message",association:"A_messageRef_correlationPropertyRetrievalExpression",isAttr:!0,isReference:!0}]},{name:"CorrelationPropertyBinding",superClass:["BaseElement"],properties:[{name:"dataPath",type:"FormalExpression",association:"A_dataPath_correlationPropertyBinding"},{name:"correlationPropertyRef",type:"CorrelationProperty",association:"A_correlationPropertyRef_correlationPropertyBinding",isAttr:!0,isReference:!0}]},{name:"Resource",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"resourceParameters",type:"ResourceParameter",association:"A_resourceParameters_resource",isMany:!0}]},{name:"ResourceParameter",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isRequired",isAttr:!0,type:"Boolean"},{name:"type",type:"ItemDefinition",association:"A_type_resourceParameter",isAttr:!0,isReference:!0}]},{name:"CorrelationSubscription",superClass:["BaseElement"],properties:[{name:"correlationKeyRef",type:"CorrelationKey",association:"A_correlationKeyRef_correlationSubscription",isAttr:!0,isReference:!0},{name:"correlationPropertyBinding",type:"CorrelationPropertyBinding",association:"A_correlationPropertyBinding_correlationSubscription",isMany:!0}]},{name:"MessageFlow",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"sourceRef",type:"InteractionNode",association:"A_sourceRef_messageFlow",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",association:"A_targetRef_messageFlow",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",association:"A_messageRef_messageFlow",isAttr:!0,isReference:!0}]},{name:"MessageFlowAssociation",superClass:["BaseElement"],properties:[{name:"innerMessageFlowRef",type:"MessageFlow",association:"A_innerMessageFlowRef_messageFlowAssociation",isAttr:!0,isReference:!0},{name:"outerMessageFlowRef",type:"MessageFlow",association:"A_outerMessageFlowRef_messageFlowAssociation",isAttr:!0,isReference:!0}]},{name:"InteractionNode",isAbstract:!0,properties:[{name:"incomingConversationLinks",type:"ConversationLink",association:"A_targetRef_incomingConversationLinks",isVirtual:!0,isMany:!0,isReference:!0},{name:"outgoingConversationLinks",type:"ConversationLink",association:"A_sourceRef_outgoingConversationLinks",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"Participant",superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"interfaceRefs",type:"Interface",association:"A_interfaceRefs_participant",isMany:!0,isReference:!0},{name:"participantMultiplicity",type:"ParticipantMultiplicity",association:"A_participantMultiplicity_participant"},{name:"endPointRefs",type:"EndPoint",association:"A_endPointRefs_participant",isMany:!0,isReference:!0},{name:"processRef",type:"Process",association:"A_processRef_participant",isAttr:!0,isReference:!0}]},{name:"ParticipantAssociation",superClass:["BaseElement"],properties:[{name:"innerParticipantRef",type:"Participant",association:"A_innerParticipantRef_participantAssociation",isAttr:!0,isReference:!0},{name:"outerParticipantRef",type:"Participant",association:"A_outerParticipantRef_participantAssociation",isAttr:!0,isReference:!0}]},{name:"ParticipantMultiplicity",properties:[{name:"minimum","default":0,isAttr:!0,type:"Integer"},{name:"maximum","default":1,isAttr:!0,type:"Integer"}]},{name:"Collaboration",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"choreographyRef",type:"Choreography",association:"A_choreographyRef_collaboration",isMany:!0,isReference:!0},{name:"artifacts",type:"Artifact",association:"A_artifacts_collaboration",isMany:!0},{name:"participantAssociations",type:"ParticipantAssociation",association:"A_participantAssociations_collaboration",isMany:!0},{name:"messageFlowAssociations",type:"MessageFlowAssociation",association:"A_messageFlowAssociations_collaboration",isMany:!0},{name:"conversationAssociations",type:"ConversationAssociation",association:"A_conversationAssociations_converstaionAssociations"},{name:"participants",type:"Participant",association:"A_participants_collaboration",isMany:!0},{name:"messageFlows",type:"MessageFlow",association:"A_messageFlows_collaboration",isMany:!0},{name:"correlationKeys",type:"CorrelationKey",association:"A_correlationKeys_collaboration",isMany:!0},{name:"conversations",type:"ConversationNode",association:"A_conversations_collaboration",isMany:!0},{name:"conversationLinks",type:"ConversationLink",association:"A_conversationLinks_collaboration",isMany:!0}]},{name:"ChoreographyActivity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"participantRefs",type:"Participant",association:"A_participantRefs_choreographyActivity",isMany:!0,isReference:!0},{name:"initiatingParticipantRef",type:"Participant",association:"A_initiatingParticipantRef_choreographyActivity",isAttr:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",association:"A_correlationKeys_choreographyActivity",isMany:!0},{name:"loopType",type:"ChoreographyLoopType","default":"None",isAttr:!0}]},{name:"CallChoreography",superClass:["ChoreographyActivity"],properties:[{name:"calledChoreographyRef",type:"Choreography",association:"A_calledChoreographyRef_callChoreographyActivity",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",association:"A_participantAssociations_callChoreographyActivity",isMany:!0}]},{name:"SubChoreography",superClass:["ChoreographyActivity","FlowElementsContainer"],properties:[{name:"artifacts",type:"Artifact",association:"A_artifacts_subChoreography",isMany:!0}]},{name:"ChoreographyTask",superClass:["ChoreographyActivity"],properties:[{name:"messageFlowRef",type:"MessageFlow",association:"A_messageFlowRef_choreographyTask",isMany:!0,isReference:!0}]},{name:"Choreography",superClass:["FlowElementsContainer","Collaboration"]},{name:"GlobalChoreographyTask",superClass:["Choreography"],properties:[{name:"initiatingParticipantRef",type:"Participant",association:"A_initiatingParticipantRef_globalChoreographyTask",isAttr:!0,isReference:!0}]},{name:"TextAnnotation",superClass:["Artifact"],properties:[{name:"text",type:"String"},{name:"textFormat","default":"text/plain",isAttr:!0,type:"String"}]},{name:"Group",superClass:["Artifact"],properties:[{name:"categoryValueRef",type:"CategoryValue",association:"A_categoryValueRef_categoryValueRef",isAttr:!0,isReference:!0}]},{name:"Association",superClass:["Artifact"],properties:[{name:"associationDirection",type:"AssociationDirection",isAttr:!0},{name:"sourceRef",type:"BaseElement",association:"A_sourceRef_outgoing_association",isAttr:!0,isReference:!0},{name:"targetRef",type:"BaseElement",association:"A_targetRef_incoming_association",isAttr:!0,isReference:!0}]},{name:"Category",superClass:["RootElement"],properties:[{name:"categoryValue",type:"CategoryValue",association:"A_categoryValue_category",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Artifact",isAbstract:!0,superClass:["BaseElement"]},{name:"CategoryValue",superClass:["BaseElement"],properties:[{name:"categorizedFlowElements",type:"FlowElement",association:"A_categorizedFlowElements_categoryValueRef",isVirtual:!0,isMany:!0,isReference:!0},{name:"value",isAttr:!0,type:"String"}]},{name:"Activity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"isForCompensation","default":!1,isAttr:!0,type:"Boolean"},{name:"loopCharacteristics",type:"LoopCharacteristics",association:"A_loopCharacteristics_activity"},{name:"resources",type:"ResourceRole",association:"A_resources_activity",isMany:!0},{name:"default",type:"SequenceFlow",association:"A_default_activity",isAttr:!0,isReference:!0},{name:"properties",type:"Property",association:"A_properties_activity",isMany:!0},{name:"ioSpecification",type:"InputOutputSpecification",association:"A_ioSpecification_activity"},{name:"boundaryEventRefs",type:"BoundaryEvent",association:"A_boundaryEventRefs_attachedToRef",isMany:!0,isReference:!0},{name:"dataInputAssociations",type:"DataInputAssociation",association:"A_dataInputAssociations_activity",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",association:"A_dataOutputAssociations_activity",isMany:!0},{name:"startQuantity","default":1,isAttr:!0,type:"Integer"},{name:"completionQuantity","default":1,isAttr:!0,type:"Integer"}]},{name:"ServiceTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",association:"A_operationRef_serviceTask",isAttr:!0,isReference:!0}]},{name:"SubProcess",superClass:["Activity","FlowElementsContainer"],properties:[{name:"triggeredByEvent","default":!1,isAttr:!0,type:"Boolean"},{name:"artifacts",type:"Artifact",association:"A_artifacts_subProcess",isMany:!0}]},{name:"LoopCharacteristics",isAbstract:!0,superClass:["BaseElement"]},{name:"MultiInstanceLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"isSequential","default":!1,isAttr:!0,type:"Boolean"},{name:"behavior",type:"MultiInstanceBehavior","default":"All",isAttr:!0},{name:"loopCardinality",type:"Expression",association:"A_loopCardinality_multiInstanceLoopCharacteristics"},{name:"loopDataInputRef",type:"ItemAwareElement",association:"A_loopDataInputRef_multiInstanceLoopCharacteristics",isAttr:!0,isReference:!0},{name:"loopDataOutputRef",type:"ItemAwareElement",association:"A_loopDataOutputRef_multiInstanceLoopCharacteristics",isAttr:!0,isReference:!0},{name:"inputDataItem",type:"DataInput",association:"A_inputDataItem_multiInstanceLoopCharacteristics"},{name:"outputDataItem",type:"DataOutput",association:"A_outputDataItem_multiInstanceLoopCharacteristics"},{name:"completionCondition",type:"Expression",association:"A_completionCondition_multiInstanceLoopCharacteristics"},{name:"complexBehaviorDefinition",type:"ComplexBehaviorDefinition",association:"A_complexBehaviorDefinition_multiInstanceLoopCharacteristics",isMany:!0},{name:"oneBehaviorEventRef",type:"EventDefinition",association:"A_oneBehaviorEventRef_multiInstanceLoopCharacteristics",isAttr:!0,isReference:!0},{name:"noneBehaviorEventRef",type:"EventDefinition",association:"A_noneBehaviorEventRef_multiInstanceLoopCharacteristics",isAttr:!0,isReference:!0}]},{name:"StandardLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"testBefore","default":!1,isAttr:!0,type:"Boolean"},{name:"loopCondition",type:"Expression",association:"A_loopCondition_standardLoopCharacteristics"},{name:"loopMaximum",type:"Expression",association:"A_loopMaximum_standardLoopCharacteristics"}]},{name:"CallActivity",superClass:["Activity"],properties:[{name:"calledElement",type:"String",association:"A_calledElementRef_callActivity",isAttr:!0}]},{name:"Task",superClass:["Activity","InteractionNode"]},{name:"SendTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",association:"A_operationRef_sendTask",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",association:"A_messageRef_sendTask",isAttr:!0,isReference:!0}]},{name:"ReceiveTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"instantiate","default":!1,isAttr:!0,type:"Boolean"},{name:"operationRef",type:"Operation",association:"A_operationRef_receiveTask",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",association:"A_messageRef_receiveTask",isAttr:!0,isReference:!0}]},{name:"ScriptTask",superClass:["Task"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"script",type:"String"}]},{name:"BusinessRuleTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"AdHocSubProcess",superClass:["SubProcess"],properties:[{name:"completionCondition",type:"Expression",association:"A_completionCondition_adHocSubProcess"},{name:"ordering",type:"AdHocOrdering",isAttr:!0},{name:"cancelRemainingInstances","default":!0,isAttr:!0,type:"Boolean"}]},{name:"Transaction",superClass:["SubProcess"],properties:[{name:"protocol",isAttr:!0,type:"String"},{name:"method",isAttr:!0,type:"String"}]},{name:"GlobalScriptTask",superClass:["GlobalTask"],properties:[{name:"scriptLanguage",isAttr:!0,type:"String"},{name:"script",isAttr:!0,type:"String"}]},{name:"GlobalBusinessRuleTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"ComplexBehaviorDefinition",superClass:["BaseElement"],properties:[{name:"condition",type:"FormalExpression",association:"A_condition_complexBehaviorDefinition"},{name:"event",type:"ImplicitThrowEvent",association:"A_event_complexBehaviorDefinition"}]},{name:"ResourceRole",superClass:["BaseElement"],properties:[{name:"resourceRef",type:"Resource",association:"A_resourceRef_activityResource",isAttr:!0,isReference:!0},{name:"resourceParameterBindings",type:"ResourceParameterBinding",association:"A_resourceParameterBindings_activityResource",isMany:!0},{name:"resourceAssignmentExpression",type:"ResourceAssignmentExpression",association:"A_resourceAssignmentExpression_activityResource"},{name:"name",isAttr:!0,type:"String"}]},{name:"ResourceParameterBinding",properties:[{name:"expression",type:"Expression",association:"A_expression_resourceParameterBinding"},{name:"parameterRef",type:"ResourceParameter",association:"A_parameterRef_resourceParameterBinding",isAttr:!0,isReference:!0}]},{name:"ResourceAssignmentExpression",properties:[{name:"expression",type:"Expression",association:"A_expression_resourceAssignmentExpression"}]},{name:"Import",properties:[{name:"importType",isAttr:!0,type:"String"},{name:"location",isAttr:!0,type:"String"},{name:"namespace",isAttr:!0,type:"String"}]},{name:"Definitions",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"targetNamespace",isAttr:!0,type:"String"},{name:"expressionLanguage","default":"http://www.w3.org/1999/XPath",isAttr:!0,type:"String"},{name:"typeLanguage","default":"http://www.w3.org/2001/XMLSchema",isAttr:!0,type:"String"},{name:"imports",type:"Import",association:"A_imports_definition",isMany:!0},{name:"extensions",type:"Extension",association:"A_extensions_definitions",isMany:!0},{name:"relationships",type:"Relationship",association:"A_relationships_definition",isMany:!0},{name:"rootElements",type:"RootElement",association:"A_rootElements_definition",isMany:!0},{name:"diagrams",association:"A_diagrams_definitions",isMany:!0,type:"bpmndi:BPMNDiagram"},{name:"exporter",isAttr:!0,type:"String"},{name:"exporterVersion",isAttr:!0,type:"String"}]}],emumerations:[{name:"ProcessType",literalValues:[{name:"None"},{name:"Public"},{name:"Private"}]},{name:"GatewayDirection",literalValues:[{name:"Unspecified"},{name:"Converging"},{name:"Diverging"},{name:"Mixed"}]},{name:"EventBasedGatewayType",literalValues:[{name:"Parallel"},{name:"Exclusive"}]},{name:"RelationshipDirection",literalValues:[{name:"None"},{name:"Forward"},{name:"Backward"},{name:"Both"}]},{name:"ItemKind",literalValues:[{name:"Physical"},{name:"Information"}]},{name:"ChoreographyLoopType",literalValues:[{name:"None"},{name:"Standard"},{name:"MultiInstanceSequential"},{name:"MultiInstanceParallel"}]},{name:"AssociationDirection",literalValues:[{name:"None"},{name:"One"},{name:"Both"}]},{name:"MultiInstanceBehavior",literalValues:[{name:"None"},{name:"One"},{name:"All"},{name:"Complex"}]},{name:"AdHocOrdering",literalValues:[{name:"Parallel"},{name:"Sequential"}]}],prefix:"bpmn",xml:{alias:"lowerCase"}}
},{}],32:[function(_dereq_,module){module.exports={name:"BPMNDI",uri:"http://www.omg.org/spec/BPMN/20100524/DI",types:[{name:"BPMNDiagram",properties:[{name:"plane",type:"BPMNPlane",association:"A_plane_diagram",redefines:"di:Diagram#rootElement"},{name:"labelStyle",type:"BPMNLabelStyle",association:"A_labelStyle_diagram",isMany:!0}],superClass:["di:Diagram"]},{name:"BPMNPlane",properties:[{name:"bpmnElement",association:"A_bpmnElement_plane",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"}],superClass:["di:Plane"]},{name:"BPMNShape",properties:[{name:"bpmnElement",association:"A_bpmnElement_shape",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"isHorizontal",isAttr:!0,type:"Boolean"},{name:"isExpanded",isAttr:!0,type:"Boolean"},{name:"isMarkerVisible",isAttr:!0,type:"Boolean"},{name:"label",type:"BPMNLabel",association:"A_label_shape"},{name:"isMessageVisible",isAttr:!0,type:"Boolean"},{name:"participantBandKind",type:"ParticipantBandKind",isAttr:!0},{name:"choreographyActivityShape",type:"BPMNShape",association:"A_choreographyActivityShape_participantBandShape",isAttr:!0,isReference:!0}],superClass:["di:LabeledShape"]},{name:"BPMNEdge",properties:[{name:"label",type:"BPMNLabel",association:"A_label_edge"},{name:"bpmnElement",association:"A_bpmnElement_edge",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"sourceElement",association:"A_sourceElement_sourceEdge",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#source"},{name:"targetElement",association:"A_targetElement_targetEdge",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#target"},{name:"messageVisibleKind",type:"MessageVisibleKind",isAttr:!0,"default":"initiating"}],superClass:["di:LabeledEdge"]},{name:"BPMNLabel",properties:[{name:"labelStyle",type:"BPMNLabelStyle",association:"A_labelStyle_label",isAttr:!0,isReference:!0,redefines:"di:DiagramElement#style"}],superClass:["di:Label"]},{name:"BPMNLabelStyle",properties:[{name:"font",type:"dc:Font"}],superClass:["di:Style"]}],emumerations:[{name:"ParticipantBandKind",literalValues:[{name:"top_initiating"},{name:"middle_initiating"},{name:"bottom_initiating"},{name:"top_non_initiating"},{name:"middle_non_initiating"},{name:"bottom_non_initiating"}]},{name:"MessageVisibleKind",literalValues:[{name:"initiating"},{name:"non_initiating"}]}],associations:[],prefix:"bpmndi"}},{}],33:[function(_dereq_,module){module.exports={name:"DC",uri:"http://www.omg.org/spec/DD/20100524/DC",types:[{name:"Boolean"},{name:"Integer"},{name:"Real"},{name:"String"},{name:"Font",properties:[{name:"name",type:"String",isAttr:!0},{name:"size",type:"Real",isAttr:!0},{name:"isBold",type:"Boolean",isAttr:!0},{name:"isItalic",type:"Boolean",isAttr:!0},{name:"isUnderline",type:"Boolean",isAttr:!0},{name:"isStrikeThrough",type:"Boolean",isAttr:!0}]},{name:"Point",properties:[{name:"x",type:"Real","default":"0",isAttr:!0},{name:"y",type:"Real","default":"0",isAttr:!0}]},{name:"Bounds",properties:[{name:"x",type:"Real","default":"0",isAttr:!0},{name:"y",type:"Real","default":"0",isAttr:!0},{name:"width",type:"Real",isAttr:!0},{name:"height",type:"Real",isAttr:!0}]}],prefix:"dc",associations:[]}},{}],34:[function(_dereq_,module){module.exports={name:"DI",uri:"http://www.omg.org/spec/DD/20100524/DI",types:[{name:"DiagramElement",isAbstract:!0,properties:[{name:"owningDiagram",type:"Diagram",isReadOnly:!0,association:"A_rootElement_owningDiagram",isVirtual:!0,isReference:!0},{name:"owningElement",type:"DiagramElement",isReadOnly:!0,association:"A_ownedElement_owningElement",isVirtual:!0,isReference:!0},{name:"modelElement",isReadOnly:!0,association:"A_modelElement_diagramElement",isVirtual:!0,isReference:!0,type:"Element"},{name:"style",type:"Style",isReadOnly:!0,association:"A_style_diagramElement",isVirtual:!0,isReference:!0},{name:"ownedElement",type:"DiagramElement",isReadOnly:!0,association:"A_ownedElement_owningElement",isVirtual:!0,isMany:!0}]},{name:"Node",isAbstract:!0,superClass:["DiagramElement"]},{name:"Edge",isAbstract:!0,superClass:["DiagramElement"],properties:[{name:"source",type:"DiagramElement",isReadOnly:!0,association:"A_source_sourceEdge",isVirtual:!0,isReference:!0},{name:"target",type:"DiagramElement",isReadOnly:!0,association:"A_target_targetEdge",isVirtual:!0,isReference:!0},{name:"waypoint",isUnique:!1,isMany:!0,type:"dc:Point",serialize:"xsi:type"}]},{name:"Diagram",isAbstract:!0,properties:[{name:"rootElement",type:"DiagramElement",isReadOnly:!0,association:"A_rootElement_owningDiagram",isVirtual:!0},{name:"name",isAttr:!0,type:"String"},{name:"documentation",isAttr:!0,type:"String"},{name:"resolution",isAttr:!0,type:"Real"},{name:"ownedStyle",type:"Style",isReadOnly:!0,association:"A_ownedStyle_owningDiagram",isVirtual:!0,isMany:!0}]},{name:"Shape",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Plane",isAbstract:!0,superClass:["Node"],properties:[{name:"planeElement",type:"DiagramElement",subsettedProperty:"DiagramElement-ownedElement",association:"A_planeElement_plane",isMany:!0}]},{name:"LabeledEdge",isAbstract:!0,superClass:["Edge"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",association:"A_ownedLabel_owningEdge",isVirtual:!0,isMany:!0}]},{name:"LabeledShape",isAbstract:!0,superClass:["Shape"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",association:"A_ownedLabel_owningShape",isVirtual:!0,isMany:!0}]},{name:"Label",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Style",isAbstract:!0}],associations:[],prefix:"di"}},{}],35:[function(_dereq_,module){module.exports=_dereq_("./lib/Diagram")},{"./lib/Diagram":36}],36:[function(_dereq_,module){"use strict";function bootstrap(bootstrapModules){function hasModule(m){return modules.indexOf(m)>=0}function addModule(m){modules.push(m)}function visit(m){hasModule(m)||((m.__depends__||[]).forEach(visit),hasModule(m)||(addModule(m),(m.__init__||[]).forEach(function(c){components.push(c)})))}var modules=[],components=[];bootstrapModules.forEach(visit);var injector=new di.Injector(modules);return components.forEach(function(c){try{injector["string"==typeof c?"get":"invoke"](c)}catch(e){throw console.error("Failed to instantiate component"),console.error(e.stack),e}}),injector}function createInjector(options){options=options||{};var configModule={config:["value",options]},coreModule=_dereq_("./core"),modules=[configModule,coreModule].concat(options.modules||[]);return bootstrap(modules)}function Diagram(options,injector){this.injector=injector=injector||createInjector(options),this.get=injector.get,this.invoke=injector.invoke,this.get("eventBus").fire("diagram.init")}var di=_dereq_("didi");module.exports=Diagram,Diagram.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")}},{"./core":42,didi:66}],37:[function(_dereq_,module){"use strict";function round(number,resolution){return Math.round(number*resolution)/resolution}function ensurePx(number){return _.isNumber(number)?number+"px":number}function createContainer(options){options=_.extend({},{width:"100%",height:"100%"},options);var container=options.container||document.body,parent=document.createElement("div");return parent.setAttribute("class","djs-container"),_.extend(parent.style,{position:"relative",width:ensurePx(options.width),height:ensurePx(options.height)}),container.appendChild(parent),parent}function createGroup(parent,cls){return parent.group().attr({"class":cls})}function Canvas(config,eventBus,graphicsFactory,elementRegistry,snap){this._snap=snap,this._eventBus=eventBus,this._elementRegistry=elementRegistry,this._graphicsFactory=graphicsFactory,this._init(config||{})}function setCTM(node,m){var mstr="matrix("+m.a+","+m.b+","+m.c+","+m.d+","+m.e+","+m.f+")";node.setAttribute("transform",mstr)}var _=window._,Collections=_dereq_("../util/Collections"),BASE_LAYER="base";Canvas.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry","snap"],module.exports=Canvas,Canvas.prototype._init=function(config){var eventBus=this._eventBus,snap=(this._graphicsFactory,this._snap),container=createContainer(config),svg=snap.createSnapAt("100%","100%",container),viewport=createGroup(svg,"viewport"),self=this;this._container=container,this._svg=svg,this._viewport=viewport,this._layers={},eventBus.on("diagram.init",function(){eventBus.fire("canvas.init",{svg:svg,viewport:viewport})}),eventBus.on("diagram.destroy",function(){var parent=self._container.parentNode;parent&&parent.removeChild(container),self._svg.remove(),self._svg=self._container=self._layers=self._viewport=null})},Canvas.prototype.getDefaultLayer=function(){return this.getLayer(BASE_LAYER)},Canvas.prototype.getLayer=function(name){if(!name)throw new Error("must specify a name");var layer=this._layers[name];return layer||(layer=this._layers[name]=createGroup(this._viewport,"layer-"+name)),layer},Canvas.prototype.getContainer=function(){return this._container},Canvas.prototype._updateMarker=function(element,marker,add){var gfx;element.id||(element=this._elementRegistry.get(element)),gfx=this.getGraphics(element),gfx&&(gfx[add?"addClass":"removeClass"](marker),this._eventBus.fire("element.marker.update",{element:element,gfx:gfx,marker:marker,add:!!add}))},Canvas.prototype.addMarker=function(element,marker){this._updateMarker(element,marker,!0)},Canvas.prototype.removeMarker=function(element,marker){this._updateMarker(element,marker,!1)},Canvas.prototype.getRootElement=function(){return this._rootElement||this.setRootElement({id:"__implicitroot"}),this._rootElement},Canvas.prototype.setRootElement=function(element,override){var rootElement=this._rootElement,elementRegistry=this._elementRegistry;if(rootElement){if(!override)throw new Error("rootElement already defined");elementRegistry.remove(rootElement)}return elementRegistry.add(element,this.getDefaultLayer(),this._svg),this._rootElement=element,element},Canvas.prototype._ensureValidId=function(element){if(!element.id)throw new Error("element must have an id");if(this._elementRegistry.get(element.id))throw new Error("element with id "+element.id+" already exists")},Canvas.prototype._setParent=function(element,parent){Collections.add(parent.children,element),element.parent=parent},Canvas.prototype._addElement=function(type,element,parent){parent=parent||this.getRootElement();var eventBus=this._eventBus,graphicsFactory=this._graphicsFactory;this._ensureValidId(element),eventBus.fire(type+".add",{element:element,parent:parent}),this._setParent(element,parent);var gfx=graphicsFactory.create(type,element);return this._elementRegistry.add(element,gfx),graphicsFactory.update(type,element,gfx),eventBus.fire(type+".added",{element:element,gfx:gfx}),element},Canvas.prototype.addShape=function(shape,parent){return this._addElement("shape",shape,parent)},Canvas.prototype.addConnection=function(connection,parent){return this._addElement("connection",connection,parent)},Canvas.prototype._removeElement=function(element,type){var elementRegistry=this._elementRegistry,graphicsFactory=this._graphicsFactory,eventBus=this._eventBus;return(element=elementRegistry.get(element.id||element))?(eventBus.fire(type+".remove",{element:element}),graphicsFactory.remove(element),Collections.remove(element.parent&&element.parent.children,element),element.parent=null,eventBus.fire(type+".removed",{element:element}),elementRegistry.remove(element),element):void 0},Canvas.prototype.removeShape=function(shape){return this._removeElement(shape,"shape")},Canvas.prototype.removeConnection=function(connection){return this._removeElement(connection,"connection")},Canvas.prototype.sendToFront=function(shape,bubble){bubble!==!1&&(bubble=!0),bubble&&shape.parent&&this.sendToFront(shape.parent),_.forEach(shape.children,function(child){this.sendToFront(child,!1)},this);var gfx=this.getGraphics(shape),gfxParent=gfx.parent();gfx.remove().appendTo(gfxParent)},Canvas.prototype.getGraphics=function(element){return this._elementRegistry.getGraphics(element)},Canvas.prototype._fireViewboxChange=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox(!1)})},Canvas.prototype.viewbox=function(box){if(void 0===box&&this._cachedViewbox)return this._cachedViewbox;var innerBox,matrix,scale,x,y,viewport=this._viewport,outerBox=this.getSize();return box?(scale=Math.max(outerBox.width/box.width,outerBox.height/box.height),matrix=(new this._snap.Matrix).scale(scale).translate(-box.x,-box.y),viewport.transform(matrix),this._fireViewboxChange(),box):(innerBox=viewport.getBBox(!0),matrix=viewport.transform().localMatrix,scale=round(matrix.a,1e3),x=round(-matrix.e||0,1e3),y=round(-matrix.f||0,1e3),box=this._cachedViewbox={x:x?x/scale:0,y:y?y/scale:0,width:outerBox.width/scale,height:outerBox.height/scale,scale:scale,inner:{width:innerBox.width,height:innerBox.height,x:innerBox.x,y:innerBox.y},outer:outerBox})},Canvas.prototype.scroll=function(delta){var node=this._viewport.node,matrix=node.getCTM();return delta&&(delta=_.extend({dx:0,dy:0},delta||{}),matrix=this._svg.node.createSVGMatrix().translate(delta.dx,delta.dy).multiply(matrix),setCTM(node,matrix),this._fireViewboxChange()),{x:matrix.e,y:matrix.f}},Canvas.prototype.zoom=function(newScale,center){var vbox=this.viewbox();if(void 0===newScale)return vbox.scale;var outer=vbox.outer;"fit-viewport"===newScale&&(newScale=Math.min(1,outer.width/(vbox.inner.width+vbox.inner.x),outer.height/(vbox.inner.height+vbox.inner.y))),"auto"===center&&(center={x:outer.width/2,y:outer.height/2});var matrix=this._setZoom(newScale,center);return this._fireViewboxChange(),round(matrix.a,1e3)},Canvas.prototype._setZoom=function(scale,center){var centerPoint,originalPoint,currentMatrix,scaleMatrix,newMatrix,svg=this._svg.node,viewport=this._viewport.node,matrix=svg.createSVGMatrix(),point=svg.createSVGPoint();currentMatrix=viewport.getCTM();var currentScale=currentMatrix.a;return center?(centerPoint=_.extend(point,center),originalPoint=centerPoint.matrixTransform(currentMatrix.inverse()),scaleMatrix=matrix.translate(originalPoint.x,originalPoint.y).scale(1/currentScale*scale).translate(-originalPoint.x,-originalPoint.y),newMatrix=currentMatrix.multiply(scaleMatrix)):newMatrix=matrix.scale(scale),setCTM(this._viewport.node,newMatrix),newMatrix},Canvas.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Canvas.prototype.getAbsoluteBBox=function(element){var bbox,vbox=this.viewbox();if(element.waypoints){var gfx=this.getGraphics(element),transformBBox=gfx.getBBox(!0);bbox=gfx.getBBox(),bbox.x-=transformBBox.x,bbox.y-=transformBBox.y,bbox.width+=2*transformBBox.x,bbox.height+=2*transformBBox.y}else bbox=element;var x=bbox.x*vbox.scale-vbox.x*vbox.scale,y=bbox.y*vbox.scale-vbox.y*vbox.scale,width=bbox.width*vbox.scale,height=bbox.height*vbox.scale;return{x:x,y:y,width:width,height:height}}},{"../util/Collections":59}],38:[function(_dereq_,module){"use strict";function ElementFactory(){this._uid=12}var Model=(window._,_dereq_("../model"));module.exports=ElementFactory,ElementFactory.prototype.createRoot=function(attrs){return this.create("root",attrs)},ElementFactory.prototype.createLabel=function(attrs){return this.create("label",attrs)},ElementFactory.prototype.createShape=function(attrs){return this.create("shape",attrs)},ElementFactory.prototype.createConnection=function(attrs){return this.create("connection",attrs)},ElementFactory.prototype.create=function(type,attrs){return attrs=attrs||{},attrs.id||(attrs.id=type+"_"+this._uid++),Model.create(type,attrs)}},{"../model":58}],39:[function(_dereq_,module){function ElementRegistry(){this._elements={}}var ELEMENT_ID="data-element-id";module.exports=ElementRegistry,ElementRegistry.prototype.add=function(element,gfx,secondaryGfx){var id=element.id;if(!id)throw new Error("element must have an id");if(this._elements[id])throw new Error("element with id "+id+" already added");gfx.attr(ELEMENT_ID,id),secondaryGfx&&secondaryGfx.attr(ELEMENT_ID,id),this._elements[id]={element:element,gfx:gfx,secondaryGfx:secondaryGfx}},ElementRegistry.prototype.remove=function(element){var elements=this._elements,id=element.id||element,container=id&&elements[id];container&&(container.gfx.attr(ELEMENT_ID,null),container.secondaryGfx&&container.secondaryGfx.attr(ELEMENT_ID,null),delete elements[id])},ElementRegistry.prototype.get=function(filter){var id;id="string"==typeof filter?filter:filter&&filter.attr(ELEMENT_ID);var container=this._elements[id];return container&&container.element},ElementRegistry.prototype.filter=function(fn){var map=this._elements,filtered=[];return Object.keys(map).forEach(function(id){var container=map[id],element=container.element,gfx=container.gfx;fn(element,gfx)&&filtered.push(element)}),filtered},ElementRegistry.prototype.getGraphics=function(filter){var id=filter.id||filter,container=this._elements[id];return container&&container.gfx}},{}],40:[function(_dereq_,module){"use strict";function Event(){}function EventBus(){this._listeners={};var self=this;this.on("diagram.destroy",1,function(){self._listeners=null})}var _=window._,DEFAULT_PRIORITY=1e3;Event.prototype={stopPropagation:function(){this.propagationStopped=!0},preventDefault:function(){this.defaultPrevented=!0},init:function(data){_.extend(this,data||{})}},module.exports=EventBus,module.exports.Event=Event,EventBus.prototype.on=function(events,priority,callback){if(events=_.isArray(events)?events:[events],_.isFunction(priority)&&(callback=priority,priority=DEFAULT_PRIORITY),!_.isNumber(priority))throw new Error("priority must be a number");var self=this,listener={priority:priority,callback:callback};events.forEach(function(e){self._addListener(e,listener)})},EventBus.prototype.once=function(event,callback){function wrappedCallback(){callback.apply(self,arguments),self.off(event,wrappedCallback)}var self=this;this.on(event,wrappedCallback)},EventBus.prototype.off=function(event,callback){var l,i,listeners=this._getListeners(event);if(callback)for(i=listeners.length-1;l=listeners[i];i--)l.callback===callback&&listeners.splice(i,1);else listeners.length=0},EventBus.prototype.fire=function(type,data){var event,originalType,listeners,i,l,args;if(args=Array.prototype.slice.call(arguments),"string"==typeof type?args.shift():(event=type,type=event.type),!type)throw new Error("no event type specified");if(listeners=this._listeners[type],!listeners)return!0;data instanceof Event?event=data:(event=Object.create(Event.prototype),event.init(data)),args[0]=event,originalType=event.type;try{for(type!==originalType&&(event.type=type),i=0,l;(l=listeners[i])&&!event.propagationStopped;i++)try{l.callback.apply(null,args)===!1&&event.preventDefault()}catch(e){if(!this.handleError(e))throw console.error("unhandled error in event listener"),console.error(e.stack),e}}finally{type!==originalType&&(event.type=originalType)}return event.defaultPrevented?!1:event.propagationStopped?null:!0},EventBus.prototype.handleError=function(error){return!this.fire("error",{error:error})},EventBus.prototype._addListener=function(event,listener){var i,l,listeners=this._getListeners(event);for(i=0;l=listeners[i];i++)if(l.priority<listener.priority)return void listeners.splice(i,0,listener);listeners.push(listener)},EventBus.prototype._getListeners=function(name){var listeners=this._listeners[name];return listeners||(this._listeners[name]=listeners=[]),listeners}},{}],41:[function(_dereq_,module){function GraphicsFactory(renderer,elementRegistry,snap){this._renderer=renderer,this._elementRegistry=elementRegistry,this._snap=snap}var _=window._,GraphicsUtil=_dereq_("../util/GraphicsUtil"),Dom=_dereq_("../util/Dom");GraphicsFactory.$inject=["renderer","elementRegistry","snap"],module.exports=GraphicsFactory,GraphicsFactory.prototype._getChildren=function(element){var childrenGfx,gfx=this._elementRegistry.getGraphics(element);return element.parent?(childrenGfx=GraphicsUtil.getChildren(gfx),childrenGfx||(childrenGfx=gfx.parent().group().attr("class","djs-children"))):childrenGfx=gfx,childrenGfx},GraphicsFactory.prototype._clear=function(gfx){var visual=GraphicsUtil.getVisual(gfx);return Dom.clear(visual.node),visual},GraphicsFactory.prototype._createContainer=function(type,parentGfx){{var outerGfx=parentGfx.group().attr("class","djs-group"),gfx=outerGfx.group().attr("class","djs-element djs-"+type);gfx.group().attr("class","djs-visual")}return gfx},GraphicsFactory.prototype.create=function(type,element){var childrenGfx=this._getChildren(element.parent);return this._createContainer(type,childrenGfx)},GraphicsFactory.prototype.updateContainments=function(elements){var parents,self=this,elementRegistry=this._elementRegistry;parents=_.reduce(elements,function(map,e){return e.parent&&(map[e.parent.id]=e.parent),map},{}),_.forEach(parents,function(parent){var childGfx=self._getChildren(parent),children=parent.children;children&&_.forEach(children.slice().reverse(),function(c){var gfx=elementRegistry.getGraphics(c);gfx.parent().prependTo(childGfx)})})},GraphicsFactory.prototype.update=function(type,element,gfx){var visual=this._clear(gfx);if("shape"===type)this._renderer.drawShape(visual,element),gfx.translate(element.x,element.y);else{if("connection"!==type)throw new Error("unknown type: "+type);this._renderer.drawConnection(visual,element)}gfx.attr("display",element.hidden?"none":"block")},GraphicsFactory.prototype.remove=function(element){var gfx=this._elementRegistry.getGraphics(element);gfx.parent().remove()}},{"../util/Dom":60,"../util/GraphicsUtil":62}],42:[function(_dereq_,module){module.exports={__depends__:[_dereq_("../draw")],__init__:["canvas"],canvas:["type",_dereq_("./Canvas")],elementRegistry:["type",_dereq_("./ElementRegistry")],elementFactory:["type",_dereq_("./ElementFactory")],eventBus:["type",_dereq_("./EventBus")],graphicsFactory:["type",_dereq_("./GraphicsFactory")]}},{"../draw":46,"./Canvas":37,"./ElementFactory":38,"./ElementRegistry":39,"./EventBus":40,"./GraphicsFactory":41}],43:[function(_dereq_,module){"use strict";function Renderer(styles){this.CONNECTION_STYLE=styles.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=styles.style({fill:"white",stroke:"fuchsia",strokeWidth:2})}function toSVGPoints(points){for(var p,result="",i=0;p=points[i];i++)result+=p.x+","+p.y+" ";return result}function createLine(points,attrs){return Snap.create("polyline",{points:toSVGPoints(points)}).attr(attrs||{})}function updateLine(gfx,points){return gfx.attr({points:toSVGPoints(points)})}var Snap=_dereq_("./Snap");module.exports=Renderer,Renderer.$inject=["styles"],Renderer.prototype.drawShape=function(gfxGroup,data){return gfxGroup.rect(0,0,data.width||0,data.height||0,10,10).attr(this.SHAPE_STYLE)},Renderer.prototype.drawConnection=function(gfxGroup,data){return createLine(data.waypoints,this.CONNECTION_STYLE).appendTo(gfxGroup)},module.exports.createLine=createLine,module.exports.updateLine=updateLine},{"./Snap":44}],44:[function(_dereq_,module){var snapsvg=window.Snap;_dereq_("./snapsvg-extensions"),module.exports=snapsvg},{"./snapsvg-extensions":47}],45:[function(_dereq_,module){"use strict";function Styles(){var defaultTraits={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}};this.cls=function(className,traits,additionalAttrs){var attrs=this.style(traits,additionalAttrs);return _.extend(attrs,{"class":className})},this.style=function(traits,additionalAttrs){_.isArray(traits)||additionalAttrs||(additionalAttrs=traits,traits=[]);var attrs=_.inject(traits,function(attrs,t){return _.extend(attrs,defaultTraits[t]||{})},{});return additionalAttrs?_.extend(attrs,additionalAttrs):attrs}}var _=window._;module.exports=Styles},{}],46:[function(_dereq_,module){"use strict";module.exports={renderer:["type",_dereq_("./Renderer")],snap:["value",_dereq_("./Snap")],styles:["type",_dereq_("./Styles")]}},{"./Renderer":43,"./Snap":44,"./Styles":45}],47:[function(){"use strict";var Snap=window.Snap;Snap.plugin(function(Snap,Element){Element.prototype.children=function(){for(var out=[],ch=this.node.childNodes,i=0,ii=ch.length;ii>i;i++)out[i]=new Snap(ch[i]);return out}}),Snap.plugin(function(Snap,Element){function split(str){return str.split(/\s+/)}function join(array){return array.join(" ")}function getClasses(e){return split(e.attr("class")||"")}function setClasses(e,classes){e.attr("class",join(classes))}Element.prototype.addClass=function(cls){var i,e,current=getClasses(this),add=split(cls);for(i=0,e;e=add[i];i++)-1===current.indexOf(e)&&current.push(e);return setClasses(this,current),this},Element.prototype.hasClass=function(cls){if(!cls)throw new Error("[snapsvg] syntax: hasClass(clsStr)");return-1!==getClasses(this).indexOf(cls)},Element.prototype.removeClass=function(cls){var i,e,idx,current=getClasses(this),remove=split(cls);for(i=0,e;e=remove[i];i++)idx=current.indexOf(e),-1!==idx&&current.splice(idx,1);return setClasses(this,current),this}}),Snap.plugin(function(Snap,Element){Element.prototype.translate=function(x,y){var matrix=new Snap.Matrix;return matrix.translate(x,y),this.transform(matrix)}}),Snap.plugin(function(Snap){Snap.create=function(name,attrs){return Snap._.wrap(Snap._.$(name,attrs))}}),Snap.plugin(function(Snap){Snap.createSnapAt=function(width,height,parentNode){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");return svg.setAttribute("width",width),svg.setAttribute("height",height),parentNode||(parentNode=document.body),parentNode.appendChild(svg),new Snap(svg)}})},{}],48:[function(_dereq_,module){"use strict";function InteractionEvents(eventBus,elementRegistry,styles,snap){function fire(type,event){var defaultPrevented,target=Dom.closest(event.target,"svg, .djs-element"),gfx=target&&snap(target),element=elementRegistry.get(gfx);gfx&&element&&(defaultPrevented=eventBus.fire(type,{element:element,gfx:gfx,originalEvent:event}),defaultPrevented&&event.preventDefault())}function mouseHandler(type){return function(event){event.button||fire(type,event)}}function registerEvents(svg){var node=svg.node;Dom.on(node,"mouseover",mouseHandler("element.hover")),Dom.on(node,"mouseout",mouseHandler("element.out")),Dom.on(node,"click",mouseHandler("element.click")),Dom.on(node,"dblclick",mouseHandler("element.dblclick")),Dom.on(node,"mousedown",mouseHandler("element.mousedown")),Dom.on(node,"mouseup",mouseHandler("element.mouseup"))}var HIT_STYLE=styles.cls("djs-hit",["no-fill","no-border"],{stroke:"white",strokeWidth:10});eventBus.on("canvas.init",function(event){registerEvents(event.svg)}),eventBus.on(["shape.added","connection.added"],function(event){{var hit,type,element=event.element,gfx=event.gfx;GraphicsUtil.getVisual(gfx)}element.waypoints?(hit=createLine(element.waypoints),type="connection"):(hit=Snap.create("rect",{x:0,y:0,width:element.width,height:element.height}),type="shape"),hit.attr(HIT_STYLE).appendTo(gfx.node)}),eventBus.on("shape.changed",function(event){var element=event.element,gfx=event.gfx,hit=gfx.select(".djs-hit");hit.attr({width:element.width,height:element.height})}),eventBus.on("connection.changed",function(event){var element=event.element,gfx=event.gfx,hit=gfx.select(".djs-hit");updateLine(hit,element.waypoints)}),this.fire=fire}var Snap=(window._,window.Snap),GraphicsUtil=_dereq_("../../util/GraphicsUtil"),Renderer=_dereq_("../../draw/Renderer"),Dom=_dereq_("../../util/Dom"),createLine=Renderer.createLine,updateLine=Renderer.updateLine;InteractionEvents.$inject=["eventBus","elementRegistry","styles","snap"],module.exports=InteractionEvents},{"../../draw/Renderer":43,"../../util/Dom":60,"../../util/GraphicsUtil":62}],49:[function(_dereq_,module){module.exports={__init__:["interactionEvents"],interactionEvents:["type",_dereq_("./InteractionEvents")]}},{"./InteractionEvents":48}],50:[function(_dereq_,module){"use strict";function Outline(eventBus,styles){function createOutline(gfx){return Snap.create("rect",OUTLINE_STYLE).prependTo(gfx)}function updateOutline(outline,bounds){outline.attr({x:-OUTLINE_OFFSET,y:-OUTLINE_OFFSET,width:bounds.width+2*OUTLINE_OFFSET,height:bounds.height+2*OUTLINE_OFFSET})}var OUTLINE_OFFSET=5,OUTLINE_STYLE=styles.cls("djs-outline",["no-fill"]);eventBus.on(["shape.added","shape.changed"],function(event){var element=event.element,gfx=event.gfx,outline=gfx.select(".djs-outline");outline||(outline=createOutline(gfx,element)),updateOutline(outline,element)})}{var Snap=window.Snap;_dereq_("../../util/GraphicsUtil")}Outline.$inject=["eventBus","styles","elementRegistry"],module.exports=Outline},{"../../util/GraphicsUtil":62}],51:[function(_dereq_,module){"use strict";module.exports={__init__:["outline"],outline:["type",_dereq_("./Outline")]}},{"./Outline":50}],52:[function(_dereq_,module){"use strict";function Overlays(config,eventBus,canvas,elementRegistry){this._eventBus=eventBus,this._canvas=canvas,this._elementRegistry=elementRegistry,this._ids=ids,this._overlayDefaults={show:{trigger:"automatic",minZoom:.7,maxZoom:5}},this._overlays={},this._overlayContainers={},this._overlayRoot=$('<div class="djs-overlay-container" />').css({position:"absolute",width:0,height:0}).prependTo(canvas.getContainer()),this._init(config)}var _=window._,$=window.$,ids=new(_dereq_("../../util/IdGenerator"))("ov");Overlays.$inject=["config.overlays","eventBus","canvas","elementRegistry"],module.exports=Overlays,Overlays.prototype.get=function(filter){if(_.isString(filter)&&(filter={id:filter}),filter.element){var container=this._getOverlayContainer(filter.element,!0);return container?filter.type?_.filter(container.overlays,{type:filter.type}):_.clone(container.overlays):[]}return filter.type?_.filter(this._overlays,{type:filter.type}):filter.id?this._overlays[filter.id]:null},Overlays.prototype.add=function(element,type,overlay){if(_.isObject(type)&&(overlay=type,type=null),element.id||(element=this._elementRegistry.get(element)),element.waypoints)throw new Error("overlays for connections are not supported");if(!overlay.position)throw new Error("must specifiy overlay position");if(!overlay.html)throw new Error("must specifiy overlay html");if(!element)throw new Error("invalid element specified");var id=this._ids.next();return overlay=_.extend({},this._overlayDefaults,overlay,{id:id,type:type,element:element,html:$(overlay.html)}),this._addOverlay(overlay),id},Overlays.prototype.remove=function(filter){var overlays=this.get(filter)||[];_.isArray(overlays)||(overlays=[overlays]);var self=this;_.forEach(overlays,function(overlay){var container=self._getOverlayContainer(overlay.element,!0);if(overlay&&(overlay.html.remove(),overlay.htmlContainer.remove(),delete overlay.htmlContainer,delete overlay.element,delete self._overlays[overlay.id]),container){var idx=container.overlays.indexOf(overlay);-1!==idx&&container.overlays.splice(idx,1)}})},Overlays.prototype.show=function(){this._overlayRoot.show()},Overlays.prototype.hide=function(){this._overlayRoot.hide()},Overlays.prototype._updateOverlayContainer=function(container){var element=container.element,html=container.html;html.css({left:element.x,top:element.y})},Overlays.prototype._updateOverlay=function(overlay){var position=overlay.position,htmlContainer=overlay.htmlContainer,element=overlay.element,left=position.left,top=position.top;void 0!==position.right&&(left=-1*position.right+element.width),void 0!==position.bottom&&(top=-1*position.bottom+element.height),htmlContainer.css({left:left||0,top:top||0})},Overlays.prototype._createOverlayContainer=function(element){var html=$("<div />").addClass("djs-overlays").addClass("djs-overlays-"+element.id).css({position:"absolute"});html.appendTo(this._overlayRoot);var container={html:html,element:element,overlays:[]};return this._updateOverlayContainer(container),container},Overlays.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1,d=viewbox.scale||1,matrix=(viewbox.x||0,viewbox.y||0,"matrix("+a+",0,0,"+d+","+-1*viewbox.x*a+","+-1*viewbox.y*d+")");
this._overlayRoot.css("transform",matrix)},Overlays.prototype._getOverlayContainer=function(element,raw){var id=element&&element.id||element,container=this._overlayContainers[id];return container||raw||(container=this._overlayContainers[id]=this._createOverlayContainer(element)),container},Overlays.prototype._addOverlay=function(overlay){var id=overlay.id,element=overlay.element,container=this._getOverlayContainer(element),htmlContainer=$("<div>",{id:id,"class":"djs-overlay"}).css({position:"absolute"}).append(overlay.html);overlay.type&&htmlContainer.addClass("djs-overlay-"+overlay.type),overlay.htmlContainer=htmlContainer,container.overlays.push(overlay),container.html.append(htmlContainer),this._overlays[id]=overlay,this._updateOverlay(overlay)},Overlays.prototype._updateOverlayVisibilty=function(viewbox){_.forEach(this._overlays,function(overlay){overlay.show&&(overlay.show.minZoom>viewbox.scale||overlay.show.maxZoom<viewbox.scale?overlay.htmlContainer.hide():overlay.htmlContainer.show())})},Overlays.prototype._init=function(config){var eventBus=this._eventBus,self=this,updateViewbox=function(viewbox){self._updateRoot(viewbox),self._updateOverlayVisibilty(viewbox),self.show()};config&&config.deferUpdate===!1||(updateViewbox=_.debounce(updateViewbox,300)),eventBus.on("canvas.viewbox.changed",function(event){self.hide(),updateViewbox(event.viewbox)}),eventBus.on(["shape.remove","connection.remove"],function(e){var overlays=self.get({element:e.element});_.forEach(overlays,function(o){self.remove(o.id)})}),eventBus.on(["commandStack.shape.move.executed","commandStack.shape.move.reverted"],function(e){var element=e.context.shape,container=self._getOverlayContainer(element,!0);container&&self._updateOverlayContainer(container)}),eventBus.on(["commandStack.shape.resize.executed","commandStack.shape.resize.reverted"],function(e){var overlays=self._overlays,element=e.context.shape;_.forEach(overlays,function(overlay){overlay.element.id===element.id&&self._updateOverlay(overlay)});var container=self._getOverlayContainer(element,!0);container&&self._updateOverlayContainer(container)}),eventBus.on("element.marker.update",function(e){var container=self._getOverlayContainer(e.element,!0);container&&container.html[e.add?"addClass":"removeClass"](e.marker)})}},{"../../util/IdGenerator":63}],53:[function(_dereq_,module){"use strict";module.exports={__init__:["overlays"],overlays:["type",_dereq_("./Overlays")]}},{"./Overlays":52}],54:[function(_dereq_,module){"use strict";function Selection(eventBus){this._eventBus=eventBus,this._selectedElements=[];var self=this;eventBus.on(["shape.remove","connection.remove"],function(e){var element=e.element;self.deselect(element)})}var _=window._;Selection.$inject=["eventBus"],module.exports=Selection,Selection.prototype.deselect=function(element){var selectedElements=this._selectedElements,idx=selectedElements.indexOf(element);if(-1!==idx){var oldSelection=selectedElements.slice();selectedElements.splice(idx,1),this._eventBus.fire("selection.changed",{oldSelection:oldSelection,newSelection:selectedElements})}},Selection.prototype.get=function(){return this._selectedElements},Selection.prototype.isSelected=function(element){return-1!==this._selectedElements.indexOf(element)},Selection.prototype.select=function(elements,add){var selectedElements=this._selectedElements,oldSelection=selectedElements.slice();_.isArray(elements)||(elements=elements?[elements]:[]);add?_.forEach(elements,function(element){-1===selectedElements.indexOf(element)&&selectedElements.push(element)}):this._selectedElements=selectedElements=elements.slice(),this._eventBus.fire("selection.changed",{oldSelection:oldSelection,newSelection:selectedElements})}},{}],55:[function(_dereq_,module){"use strict";function SelectionBehavior(eventBus,selection,canvas){eventBus.on("create.end",500,function(e){e.context.canExecute&&selection.select(e.shape)}),eventBus.on("connect.end",500,function(e){e.context.canExecute&&e.context.target&&selection.select(e.context.target)}),eventBus.on("shape.move.end",500,function(e){selection.select(e.context.shapes)}),eventBus.on("element.click",function(event){var element=event.element;(element===canvas.getRootElement()||element.waypoints)&&(element=null);var add=(getOriginalEvent(event)||event).shiftKey;selection.select(element,add)})}var getOriginalEvent=_dereq_("../../util/Event").getOriginal;SelectionBehavior.$inject=["eventBus","selection","canvas"],module.exports=SelectionBehavior},{"../../util/Event":61}],56:[function(_dereq_,module){"use strict";function SelectionVisuals(events,canvas){function addMarker(e,cls){canvas.addMarker(e,cls)}function removeMarker(e,cls){canvas.removeMarker(e,cls)}events.on("element.hover",function(event){addMarker(event.element,MARKER_HOVER)}),events.on("element.out",function(event){removeMarker(event.element,MARKER_HOVER)}),events.on("selection.changed",function(event){function deselect(s){removeMarker(s,MARKER_SELECTED)}function select(s){addMarker(s,MARKER_SELECTED)}var oldSelection=event.oldSelection,newSelection=event.newSelection;_.forEach(oldSelection,function(e){-1===newSelection.indexOf(e)&&deselect(e)}),_.forEach(newSelection,function(e){-1===oldSelection.indexOf(e)&&select(e)})})}var _=window._,MARKER_HOVER="hover",MARKER_SELECTED="selected";SelectionVisuals.$inject=["eventBus","canvas"],module.exports=SelectionVisuals},{}],57:[function(_dereq_,module){"use strict";module.exports={__init__:["selectionVisuals","selectionBehavior"],__depends__:[_dereq_("../interaction-events"),_dereq_("../outline")],selection:["type",_dereq_("./Selection")],selectionVisuals:["type",_dereq_("./SelectionVisuals")],selectionBehavior:["type",_dereq_("./SelectionBehavior")]}},{"../interaction-events":49,"../outline":51,"./Selection":54,"./SelectionBehavior":55,"./SelectionVisuals":56}],58:[function(_dereq_,module){"use strict";function Base(){Object.defineProperty(this,"businessObject",{writable:!0}),parentRefs.bind(this,"parent"),labelRefs.bind(this,"label"),outgoingRefs.bind(this,"outgoing"),incomingRefs.bind(this,"incoming")}function Shape(){Base.call(this),parentRefs.bind(this,"children")}function Root(){Shape.call(this)}function Label(){Shape.call(this),labelRefs.bind(this,"labelTarget")}function Connection(){Base.call(this),outgoingRefs.bind(this,"source"),incomingRefs.bind(this,"target")}var _=window._,Refs=_dereq_("object-refs"),parentRefs=new Refs({name:"children",enumerable:!0,collection:!0},{name:"parent"}),labelRefs=new Refs({name:"label",enumerable:!0},{name:"labelTarget"}),outgoingRefs=new Refs({name:"outgoing",collection:!0},{name:"source"}),incomingRefs=new Refs({name:"incoming",collection:!0},{name:"target"});Shape.prototype=Object.create(Base.prototype),Root.prototype=Object.create(Shape.prototype),Label.prototype=Object.create(Shape.prototype),Connection.prototype=Object.create(Base.prototype);var types={connection:Connection,shape:Shape,label:Label,root:Root};module.exports.create=function(type,attrs){var Type=types[type];if(!Type)throw new Error("unknown type: <"+type+">");return _.extend(new Type,attrs)},module.exports.Base=Base,module.exports.Root=Root,module.exports.Shape=Shape,module.exports.Connection=Connection,module.exports.Label=Label},{"object-refs":69}],59:[function(_dereq_,module){"use strict";module.exports.remove=function(collection,element){if(collection&&element){var idx=collection.indexOf(element);if(-1!==idx)return collection.splice(idx,1),element}},module.exports.add=function(collection,element,idx){if(collection&&element){isNaN(idx)&&(idx=-1);var currentIdx=collection.indexOf(element);if(-1!==currentIdx){if(currentIdx===idx)return;if(-1===idx)return;collection.splice(currentIdx,1)}-1!==idx?collection.splice(idx,0,element):collection.push(element)}},module.exports.indexOf=function(collection,element){return collection&&element?collection.indexOf(element):-1}},{}],60:[function(_dereq_,module){function matches(element,selector){return matchFn.call(element,selector)}function closest(element,selector){for(;element&&element instanceof Element;){if(matches(element,selector))return element;element=element.parentNode}return null}function clear(element){for(;element.childNodes.length;)element.removeChild(element.childNodes[0])}function on(element,type,fn,useCapture){element.addEventListener(type,fn,useCapture||!1)}function off(element,type,fn,useCapture){element.removeEventListener(type,fn,useCapture||!1)}function once(element,type,fn,useCapture){var wrappedFn=function(e){fn(e),off(element,type,wrappedFn,useCapture)};on(element,type,wrappedFn,useCapture)}var elementProto=Element.prototype,matchPolyfill=function(selector){for(var element=this,matches=(element.document||element.ownerDocument).querySelectorAll(selector),i=0;matches[i]&&matches[i]!==element;)i++;return matches[i]?!0:!1},matchFn=elementProto.matches||elementProto.mozMatchesSelector||elementProto.webkitMatchesSelecor||elementProto.msMatchesSelector||matchPolyfill;module.exports.matches=matches,module.exports.closest=closest,module.exports.clear=clear,module.exports.on=on,module.exports.off=off,module.exports.once=once},{}],61:[function(_dereq_,module){function __preventDefault(event){return event&&event.preventDefault()}function __stopPropagation(event,immediate){event&&(event.stopPropagation&&event.stopPropagation(),immediate&&event.stopImmediatePropagation&&event.stopImmediatePropagation())}function getOriginal(event){return event.originalEvent||event.srcEvent}function stopEvent(event,immediate){stopPropagation(event,immediate),preventDefault(event)}function preventDefault(event){__preventDefault(event),__preventDefault(getOriginal(event))}function stopPropagation(event,immediate){__stopPropagation(event,immediate),__stopPropagation(getOriginal(event),immediate)}function toPoint(event){return event.pointers&&event.pointers.length&&(event=event.pointers[0]),event.touches&&event.touches.length&&(event=event.touches[0]),event?{x:event.clientX,y:event.clientY}:null}module.exports.getOriginal=getOriginal,module.exports.stopEvent=stopEvent,module.exports.preventDefault=preventDefault,module.exports.stopPropagation=stopPropagation,module.exports.toPoint=toPoint},{}],62:[function(_dereq_,module){function getVisual(gfx){return gfx.select(".djs-visual")}function getChildren(gfx){return gfx.parent().children()[1]}function getBBox(gfx){return getVisual(gfx).select("*").getBBox()}module.exports.getVisual=getVisual,module.exports.getChildren=getChildren,module.exports.getBBox=getBBox},{}],63:[function(_dereq_,module){"use strict";function IdGenerator(prefix){this._counter=0,this._prefix=(prefix?prefix+"-":"")+Math.floor(1e9*Math.random())+"-"}module.exports=IdGenerator,IdGenerator.prototype.next=function(){return this._prefix+ ++this._counter}},{}],64:[function(_dereq_,module){"use strict";function parseAlign(align){var parts=align.split("-");return{horizontal:parts[0]||"center",vertical:parts[1]||"top"}}function parsePadding(padding){return _.isObject(padding)?_.extend({top:0,left:0,right:0,bottom:0},padding):{top:padding,left:padding,right:padding,bottom:padding}}function Text(config){this._config=_.extend({},{size:DEFAULT_LABEL_SIZE,padding:DEFAULT_BOX_PADDING,style:{},align:"center-top"},config||{})}var Snap=window.Snap,_=window._,DEFAULT_BOX_PADDING=0,DEFAULT_LABEL_SIZE={width:150,height:50};Text.prototype.createText=function(parent,text,options){function layoutNext(lines){function fit(){if(fitLine.length<originalLine.length){var nextLine=lines[0]||"",remainder=originalLine.slice(fitLine.length);nextLine=/-\s*$/.test(remainder)?remainder.replace(/-\s*$/,"")+nextLine.replace(/^\s+/,""):remainder+" "+nextLine,lines[0]=nextLine}return{width:textBBox.width,height:textBBox.height,text:fitLine}}function getTextBBox(text){return fakeText.textContent=text,fakeText.getBBox()}function semanticShorten(line,maxLength){var part,parts=line.split(/(\s|-)/g),shortenedParts=[],length=0;if(parts.length>1)for(;part=parts.shift();){if(!(part.length+length<maxLength)){"-"===part&&shortenedParts.pop();break}shortenedParts.push(part),length+=part.length}return shortenedParts.join("")}function shortenLine(line,width,maxWidth){var length=line.length*(maxWidth/width),shortenedLine=semanticShorten(line,length);return shortenedLine||(shortenedLine=line.slice(0,Math.floor(length-1))),shortenedLine}for(var textBBox,originalLine=lines.shift(),fitLine=originalLine;;){if(textBBox=getTextBBox(fitLine),textBBox.width<maxWidth)return fit();fitLine=shortenLine(fitLine,textBBox.width,maxWidth)}}var box=_.merge({},this._config.size,options.box||{}),style=_.merge({},this._config.style,options.style||{}),align=parseAlign(options.align||this._config.align),padding=parsePadding(void 0!==options.padding?options.padding:this._config.padding),lines=text.split(/\r?\n/g),layouted=[],maxWidth=box.width-padding.left-padding.right,fakeText=parent.text(0,0,"").attr(style).node;for(fakeText.ownerSVGElement.appendChild(fakeText);lines.length;)layouted.push(layoutNext(lines));{var y,x,totalHeight=_.reduce(layouted,function(sum,line){return sum+line.height},0);box.width/2}switch(align.vertical){case"middle":y=(box.height-totalHeight)/2-layouted[0].height/4;break;default:y=padding.top}var textElement=parent.text().attr(style);return _.forEach(layouted,function(line){switch(y+=line.height,align.horizontal){case"left":x=padding.left;break;case"right":x=maxWidth-padding.right-line.width;break;default:x=(maxWidth-line.width)/2+padding.left}var tspan=Snap.create("tspan",{x:x,y:y}).node;tspan.textContent=line.text,textElement.append(tspan)}),fakeText.parentNode.removeChild(fakeText),textElement},module.exports=Text},{}],65:[function(_dereq_,module,exports){var isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},annotate=function(){var args=Array.prototype.slice.call(arguments);1===args.length&&isArray(args[0])&&(args=args[0]);var fn=args.pop();return fn.$inject=args,fn},FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,FN_ARG=/\/\*([^\*]*)\*\//m,parse=function(fn){if("function"!=typeof fn)throw new Error('Cannot annotate "'+fn+'". Expected a function!');var match=fn.toString().match(FN_ARGS);return match[1]&&match[1].split(",").map(function(arg){return match=arg.match(FN_ARG),match?match[1].trim():arg.trim()})||[]};exports.annotate=annotate,exports.parse=parse,exports.isArray=isArray},{}],66:[function(_dereq_,module){module.exports={annotate:_dereq_("./annotation").annotate,Module:_dereq_("./module"),Injector:_dereq_("./injector")}},{"./annotation":65,"./injector":67,"./module":68}],67:[function(_dereq_,module){var Module=_dereq_("./module"),autoAnnotate=_dereq_("./annotation").parse,annotate=_dereq_("./annotation").annotate,isArray=_dereq_("./annotation").isArray,Injector=function(modules,parent){parent=parent||{get:function(name){throw currentlyResolving.push(name),error('No provider for "'+name+'"!')}};var currentlyResolving=[],providers=this._providers=Object.create(parent._providers||null),instances=this._instances=Object.create(null),self=instances.injector=this,error=function(msg){var stack=currentlyResolving.join(" -> ");return currentlyResolving.length=0,new Error(stack?msg+" (Resolving: "+stack+")":msg)},get=function(name){if(!providers[name]&&-1!==name.indexOf(".")){for(var parts=name.split("."),pivot=get(parts.shift());parts.length;)pivot=pivot[parts.shift()];return pivot}if(Object.hasOwnProperty.call(instances,name))return instances[name];if(Object.hasOwnProperty.call(providers,name)){if(-1!==currentlyResolving.indexOf(name))throw currentlyResolving.push(name),error("Cannot resolve circular dependency!");return currentlyResolving.push(name),instances[name]=providers[name][0](providers[name][1]),currentlyResolving.pop(),instances[name]}return parent.get(name)},instantiate=function(Type){var instance=Object.create(Type.prototype),returned=invoke(Type,instance);return"object"==typeof returned?returned:instance},invoke=function(fn,context){if("function"!=typeof fn){if(!isArray(fn))throw new Error('Cannot invoke "'+fn+'". Expected a function!');fn=annotate(fn.slice())}var inject=fn.$inject&&fn.$inject||autoAnnotate(fn),dependencies=inject.map(function(dep){return get(dep)});return fn.apply(context,dependencies)},createPrivateInjectorFactory=function(privateChildInjector){return annotate(function(key){return privateChildInjector.get(key)})},createChild=function(modules,forceNewInstances){if(forceNewInstances&&forceNewInstances.length){var provider,cacheIdx,privateChildInjector,privateChildInjectorFactory,fromParentModule=Object.create(null),matchedScopes=Object.create(null),privateInjectorsCache=[],privateChildInjectors=[],privateChildFactories=[];for(var name in providers)provider=providers[name],-1!==forceNewInstances.indexOf(name)&&("private"===provider[2]?(cacheIdx=privateInjectorsCache.indexOf(provider[3]),-1===cacheIdx?(privateChildInjector=provider[3].createChild([],forceNewInstances),privateChildInjectorFactory=createPrivateInjectorFactory(privateChildInjector),privateInjectorsCache.push(provider[3]),privateChildInjectors.push(privateChildInjector),privateChildFactories.push(privateChildInjectorFactory),fromParentModule[name]=[privateChildInjectorFactory,name,"private",privateChildInjector]):fromParentModule[name]=[privateChildFactories[cacheIdx],name,"private",privateChildInjectors[cacheIdx]]):fromParentModule[name]=[provider[2],provider[1]],matchedScopes[name]=!0),"factory"!==provider[2]&&"type"!==provider[2]||!provider[1].$scope||forceNewInstances.forEach(function(scope){-1!==provider[1].$scope.indexOf(scope)&&(fromParentModule[name]=[provider[2],provider[1]],matchedScopes[scope]=!0)});forceNewInstances.forEach(function(scope){if(!matchedScopes[scope])throw new Error('No provider for "'+scope+'". Cannot use provider from the parent!')}),modules.unshift(fromParentModule)}return new Injector(modules,self)},factoryMap={factory:invoke,type:instantiate,value:function(value){return value}};modules.forEach(function(module){function arrayUnwrap(type,value){return"value"!==type&&isArray(value)&&(value=annotate(value.slice())),value}if(module instanceof Module)module.forEach(function(provider){var name=provider[0],type=provider[1],value=provider[2];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]});else if("object"==typeof module)if(module.__exports__){var clonedModule=Object.keys(module).reduce(function(m,key){return"__"!==key.substring(0,2)&&(m[key]=module[key]),m},Object.create(null)),privateInjector=new Injector((module.__modules__||[]).concat([clonedModule]),self),getFromPrivateInjector=annotate(function(key){return privateInjector.get(key)});module.__exports__.forEach(function(key){providers[key]=[getFromPrivateInjector,key,"private",privateInjector]})}else Object.keys(module).forEach(function(name){if("private"===module[name][2])return void(providers[name]=module[name]);var type=module[name][0],value=module[name][1];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]})}),this.get=get,this.invoke=invoke,this.instantiate=instantiate,this.createChild=createChild};module.exports=Injector},{"./annotation":65,"./module":68}],68:[function(_dereq_,module){var Module=function(){var providers=[];this.factory=function(name,factory){return providers.push([name,"factory",factory]),this},this.value=function(name,value){return providers.push([name,"value",value]),this},this.type=function(name,type){return providers.push([name,"type",type]),this},this.forEach=function(iterator){providers.forEach(iterator)}};module.exports=Module},{}],69:[function(_dereq_,module){module.exports=_dereq_("./lib/refs"),module.exports.Collection=_dereq_("./lib/collection")},{"./lib/collection":70,"./lib/refs":71}],70:[function(_dereq_,module){"use strict";function extend(collection,refs,property,target){var inverseProperty=property.inverse;return collection.remove=function(element){var idx=this.indexOf(element);return-1!==idx&&(this.splice(idx,1),refs.unset(element,inverseProperty,target)),element},collection.contains=function(element){return-1!==this.indexOf(element)},collection.add=function(element){this.contains(element)||(this.push(element),refs.set(element,inverseProperty,target))},collection}module.exports.extend=extend},{}],71:[function(_dereq_,module){"use strict";function hasOwnProperty(e,property){return Object.prototype.hasOwnProperty.call(e,property.name||property)}function defineCollectionProperty(ref,property,target){Object.defineProperty(target,property.name,{enumerable:property.enumerable,value:Collection.extend(target[property.name]||[],ref,property,target)})}function defineProperty(ref,property,target){var inverseProperty=property.inverse,_value=target[property.name];Object.defineProperty(target,property.name,{enumerable:property.enumerable,get:function(){return _value},set:function(value){if(value!==_value){var old=_value;_value=null,old&&ref.unset(old,inverseProperty,target),_value=value,ref.set(_value,inverseProperty,target)}}})}function Refs(a,b){return this instanceof Refs?(a.inverse=b,b.inverse=a,this.props={},this.props[a.name]=a,void(this.props[b.name]=b)):new Refs(a,b)}var Collection=_dereq_("./collection");Refs.prototype.bind=function(target,property){if("string"==typeof property){if(!this.props[property])throw new Error("no property <"+property+"> in ref");property=this.props[property]}property.collection?defineCollectionProperty(this,property,target):defineProperty(this,property,target)},Refs.prototype.ensureBound=function(target,property){hasOwnProperty(target,property)||this.bind(target,property)},Refs.prototype.unset=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?target[property.name].remove(value):target[property.name]=void 0)},Refs.prototype.set=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?target[property.name].add(value):target[property.name]=value)},module.exports=Refs},{"./collection":70}],72:[function(_dereq_,module){function substract(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y}}function length(point){return Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))}function MoveCanvas(eventBus,canvas){function handleMove(event){var start=context.start,position=Event.toPoint(event),delta=substract(position,start);if(!context.dragging&&length(delta)>THRESHOLD&&(context.dragging=!0,Cursor.set("move")),context.dragging){var lastPosition=context.last||context.start;delta=substract(position,lastPosition),canvas.scroll({dx:delta.x,dy:delta.y}),context.last=position}event.preventDefault()}function handleEnd(event){Dom.off(document,"mousemove",handleMove),Dom.off(document,"mouseup",handleEnd),context=null,Cursor.unset(),Event.stopEvent(event)}function handleStart(event){event.button||(context={start:Event.toPoint(event)},Dom.on(document,"mousemove",handleMove),Dom.on(document,"mouseup",handleEnd),Event.stopEvent(event))}var context,container=canvas._container;Dom.on(container,"mousedown",handleStart)}var Cursor=(window._,_dereq_("../../util/Cursor")),Dom=_dereq_("../../util/Dom"),Event=_dereq_("../../util/Event"),THRESHOLD=15;MoveCanvas.$inject=["eventBus","canvas"],module.exports=MoveCanvas},{"../../util/Cursor":76,"../../util/Dom":77,"../../util/Event":78}],73:[function(_dereq_,module){module.exports={__init__:["moveCanvas"],moveCanvas:["type",_dereq_("./MoveCanvas")]}},{"./MoveCanvas":72}],74:[function(_dereq_,module){"use strict";function ZoomScroll(events,canvas){function cap(scale){return Math.max(RANGE.min,Math.min(RANGE.max,scale))}function reset(){canvas.zoom("fit-viewport")}function zoom(direction,position){var currentZoom=canvas.zoom(),factor=1+direction/ZOOM_OFFSET;canvas.zoom(cap(currentZoom*factor),position)}function init(element){$(element).on("mousewheel",function(event){var shift=event.shiftKey,ctrl=event.ctrlKey,x=event.deltaX,y=event.deltaY;if(shift||ctrl){var delta={};ctrl?delta.dx=SCROLL_OFFSET*x:delta.dy=SCROLL_OFFSET*x,canvas.scroll(delta)}else{var offset={};offset=event.originalEvent.offsetX?{x:event.offsetX,y:event.offsetY}:{x:event.originalEvent.layerX,y:event.originalEvent.layerY},zoom(y,offset)}event.preventDefault()})}var RANGE={min:.2,max:4},ZOOM_OFFSET=5,SCROLL_OFFSET=50;events.on("canvas.init",function(e){init(e.svg.node)}),this.zoom=zoom,this.reset=reset}var $=window.$,mousewheel=window.$;mousewheel===$||$.mousewheel||mousewheel($),ZoomScroll.$inject=["eventBus","canvas"],module.exports=ZoomScroll},{}],75:[function(_dereq_,module){module.exports={__init__:["zoomScroll"],zoomScroll:["type",_dereq_("./ZoomScroll")]}},{"./ZoomScroll":74}],76:[function(_dereq_,module){"use strict";var _=window._,CURSOR_CLS_PATTERN=/^djs-cursor-.*$/;module.exports.set=function(mode){var classList=document.body.classList;_.forEach(_.clone(classList),function(cls){CURSOR_CLS_PATTERN.test(cls)&&classList.remove(cls)}),mode&&classList.add("djs-cursor-"+mode)},module.exports.unset=function(){this.set(null)}},{}],77:[function(_dereq_,module){module.exports=_dereq_(60)},{}],78:[function(_dereq_,module){module.exports=_dereq_(61)},{}]},{},[1])(1)});